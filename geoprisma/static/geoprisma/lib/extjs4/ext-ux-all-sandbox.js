Ext4.define("Ext4.ux.form.MultiSelect",{extend:"Ext4.form.FieldContainer",mixins:{bindable:"Ext4.util.Bindable",field:"Ext4.form.field.Field"},alternateClassName:"Ext4.ux.Multiselect",alias:["widget.multiselectfield","widget.multiselect"],requires:["Ext4.panel.Panel","Ext4.view.BoundList","Ext4.layout.container.Fit"],uses:["Ext4.view.DragZone","Ext4.view.DropZone"],layout:"fit",ddReorder:false,appendOnly:false,displayField:"text",allowBlank:true,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:"This field is required",minSelectionsText:"Minimum {0} item(s) required",maxSelectionsText:"Minimum {0} item(s) required",delimiter:",",ignoreSelectChange:0,initComponent:function(){var e=this;e.bindStore(e.store,true);if(e.store.autoCreated){e.valueField=e.displayField="field1";if(!e.store.expanded){e.displayField="field2"}}if(!Ext4.isDefined(e.valueField)){e.valueField=e.displayField}e.items=e.setupItems();e.callParent();e.initField();e.addEvents("drop")},setupItems:function(){var e=this;e.boundList=Ext4.create("Ext4.view.BoundList",Ext4.apply({deferInitialRefresh:false,border:false,multiSelect:true,store:e.store,displayField:e.displayField,disabled:e.disabled},e.listConfig));e.boundList.getSelectionModel().on("selectionchange",e.onSelectChange,e);return{border:true,layout:"fit",title:e.title,tbar:e.tbar,items:e.boundList}},onSelectChange:function(e,t){if(!this.ignoreSelectChange){this.setValue(t)}},getSelected:function(){return this.boundList.getSelectionModel().getSelection()},isEqual:function(e,t){var n=Ext4.Array.from,r=0,i;e=n(e);t=n(t);i=e.length;if(i!==t.length){return false}for(;r<i;r++){if(t[r]!==e[r]){return false}}return true},afterRender:function(){var e=this;e.callParent();if(e.selectOnRender){++e.ignoreSelectChange;e.boundList.getSelectionModel().select(e.getRecordsForValue(e.value));--e.ignoreSelectChange;delete e.toSelect}if(e.ddReorder&&!e.dragGroup&&!e.dropGroup){e.dragGroup=e.dropGroup="MultiselectDD-"+Ext4.id()}if(e.draggable||e.dragGroup){e.dragZone=Ext4.create("Ext4.view.DragZone",{view:e.boundList,ddGroup:e.dragGroup,dragText:"{0} Item{1}"})}if(e.droppable||e.dropGroup){e.dropZone=Ext4.create("Ext4.view.DropZone",{view:e.boundList,ddGroup:e.dropGroup,handleNodeDrop:function(t,n,r){var i=this.view,s=i.getStore(),o=t.records,u;t.view.store.remove(o);u=s.indexOf(n);if(r==="after"){u++}s.insert(u,o);i.getSelectionModel().select(o);e.fireEvent("drop",e,o)}})}},isValid:function(){var e=this,t=e.disabled,n=e.forceValidation||!t;return n?e.validateValue(e.value):t},validateValue:function(e){var t=this,n=t.getErrors(e),r=Ext4.isEmpty(n);if(!t.preventMark){if(r){t.clearInvalid()}else{t.markInvalid(n)}}return r},markInvalid:function(e){var t=this,n=t.getActiveError();t.setActiveErrors(Ext4.Array.from(e));if(n!==t.getActiveError()){t.updateLayout()}},clearInvalid:function(){var e=this,t=e.hasActiveError();e.unsetActiveError();if(t){e.updateLayout()}},getSubmitData:function(){var e=this,t=null,n;if(!e.disabled&&e.submitValue&&!e.isFileUpload()){n=e.getSubmitValue();if(n!==null){t={};t[e.getName()]=n}}return t},getSubmitValue:function(){var e=this,t=e.delimiter,n=e.getValue();return Ext4.isString(t)?n.join(t):n},getValue:function(){return this.value},getRecordsForValue:function(e){var t=this,n=[],r=t.store.getRange(),i=t.valueField,s=0,o=r.length,u,a,f;for(f=e.length;s<f;++s){for(a=0;a<o;++a){u=r[a];if(u.get(i)==e[s]){n.push(u)}}}return n},setupValue:function(e){var t=this.delimiter,n=this.valueField,r=0,i,s,o;if(Ext4.isDefined(e)){if(t&&Ext4.isString(e)){e=e.split(t)}else if(!Ext4.isArray(e)){e=[e]}for(s=e.length;r<s;++r){o=e[r];if(o&&o.isModel){e[r]=o.get(n)}}i=Ext4.Array.unique(e)}else{i=[]}return i},setValue:function(e){var t=this,n=t.boundList.getSelectionModel();if(!t.store.getCount()){t.store.on({load:Ext4.Function.bind(t.setValue,t,[e]),single:true});return}e=t.setupValue(e);t.mixins.field.setValue.call(t,e);if(t.rendered){++t.ignoreSelectChange;n.deselectAll();n.select(t.getRecordsForValue(e));--t.ignoreSelectChange}else{t.selectOnRender=true}},clearValue:function(){this.setValue([])},onEnable:function(){var e=this.boundList;this.callParent();if(e){e.enable()}},onDisable:function(){var e=this.boundList;this.callParent();if(e){e.disable()}},getErrors:function(e){var t=this,n=Ext4.String.format,r=[],i;e=Ext4.Array.from(e||t.getValue());i=e.length;if(!t.allowBlank&&i<1){r.push(t.blankText)}if(i<t.minSelections){r.push(n(t.minSelectionsText,t.minSelections))}if(i>t.maxSelections){r.push(n(t.maxSelectionsText,t.maxSelections))}return r},onDestroy:function(){var e=this;e.bindStore(null);Ext4.destroy(e.dragZone,e.dropZone);e.callParent()},onBindStore:function(e){var t=this.boundList;if(t){t.bindStore(e)}}});Ext4.define("Ext4.ux.form.ItemSelector",{extend:"Ext4.ux.form.MultiSelect",alias:["widget.itemselectorfield","widget.itemselector"],alternateClassName:["Ext4.ux.ItemSelector"],requires:["Ext4.button.Button","Ext4.ux.form.MultiSelect"],hideNavIcons:false,buttons:["top","up","add","remove","down","bottom"],buttonsText:{top:"Move to Top",up:"Move Up",add:"Add to Selected",remove:"Remove from Selected",down:"Move Down",bottom:"Move to Bottom"},initComponent:function(){var e=this;e.ddGroup=e.id+"-dd";e.callParent();e.bindStore(e.store)},createList:function(e){var t=this;return Ext4.create("Ext4.ux.form.MultiSelect",{submitValue:false,flex:1,dragGroup:t.ddGroup,dropGroup:t.ddGroup,title:e,store:{model:t.store.model,data:[]},displayField:t.displayField,disabled:t.disabled,listeners:{boundList:{scope:t,itemdblclick:t.onItemDblClick,drop:t.syncValue}}})},setupItems:function(){var e=this;e.fromField=e.createList(e.fromTitle);e.toField=e.createList(e.toTitle);return{border:false,layout:{type:"hbox",align:"stretch"},items:[e.fromField,{xtype:"container",margins:"0 4",width:22,layout:{type:"vbox",pack:"center"},items:e.createButtons()},e.toField]}},createButtons:function(){var e=this,t=[];if(!e.hideNavIcons){Ext4.Array.forEach(e.buttons,function(n){t.push({xtype:"button",tooltip:e.buttonsText[n],handler:e["on"+Ext4.String.capitalize(n)+"BtnClick"],cls:Ext4.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext4.baseCSSPrefix+"form-itemselector-"+n,navBtn:true,scope:e,margin:"4 0 0 0"})})}return t},getSelections:function(e){var t=e.getStore();return Ext4.Array.sort(e.getSelectionModel().getSelection(),function(e,n){e=t.indexOf(e);n=t.indexOf(n);if(e<n){return-1}else if(e>n){return 1}return 0})},onTopBtnClick:function(){var e=this.toField.boundList,t=e.getStore(),n=this.getSelections(e);t.suspendEvents();t.remove(n,true);t.insert(0,n);t.resumeEvents();e.refresh();this.syncValue();e.getSelectionModel().select(n)},onBottomBtnClick:function(){var e=this.toField.boundList,t=e.getStore(),n=this.getSelections(e);t.suspendEvents();t.remove(n,true);t.add(n);t.resumeEvents();e.refresh();this.syncValue();e.getSelectionModel().select(n)},onUpBtnClick:function(){var e=this.toField.boundList,t=e.getStore(),n=this.getSelections(e),r,i=0,s=n.length,o=0;t.suspendEvents();for(;i<s;++i,o++){r=n[i];o=Math.max(o,t.indexOf(r)-1);t.remove(r,true);t.insert(o,r)}t.resumeEvents();e.refresh();this.syncValue();e.getSelectionModel().select(n)},onDownBtnClick:function(){var e=this.toField.boundList,t=e.getStore(),n=this.getSelections(e),r,i=n.length-1,s=t.getCount()-1;t.suspendEvents();for(;i>-1;--i,s--){r=n[i];s=Math.min(s,t.indexOf(r)+1);t.remove(r,true);t.insert(s,r)}t.resumeEvents();e.refresh();this.syncValue();e.getSelectionModel().select(n)},onAddBtnClick:function(){var e=this,t=e.getSelections(e.fromField.boundList);e.moveRec(true,t);e.toField.boundList.getSelectionModel().select(t)},onRemoveBtnClick:function(){var e=this,t=e.getSelections(e.toField.boundList);e.moveRec(false,t);e.fromField.boundList.getSelectionModel().select(t)},moveRec:function(e,t){var n=this,r=n.fromField,i=n.toField,s=e?r.store:i.store,o=e?i.store:r.store;s.suspendEvents();o.suspendEvents();s.remove(t);o.add(t);s.resumeEvents();o.resumeEvents();r.boundList.refresh();i.boundList.refresh();n.syncValue()},syncValue:function(){var e=this;e.mixins.field.setValue.call(e,e.setupValue(e.toField.store.getRange()))},onItemDblClick:function(e,t){this.moveRec(e===this.fromField.boundList,t)},setValue:function(e){var t=this,n=t.fromField,r=t.toField,i=n.store,s=r.store,o;if(!t.fromStorePopulated){t.fromField.store.on({load:Ext4.Function.bind(t.setValue,t,[e]),single:true});return}e=t.setupValue(e);t.mixins.field.setValue.call(t,e);o=t.getRecordsForValue(e);i.suspendEvents();s.suspendEvents();i.removeAll();s.removeAll();t.populateFromStore(t.store);Ext4.Array.forEach(o,function(e){if(i.indexOf(e)>-1){i.remove(e)}s.add(e)});i.resumeEvents();s.resumeEvents();Ext4.suspendLayouts();n.boundList.refresh();r.boundList.refresh();Ext4.resumeLayouts(true)},onBindStore:function(e,t){var n=this;if(n.fromField){n.fromField.store.removeAll();n.toField.store.removeAll();if(e.getCount()){n.populateFromStore(e)}else{n.store.on("load",n.populateFromStore,n)}}},populateFromStore:function(e){var t=this.fromField.store;this.fromStorePopulated=true;t.add(e.getRange());t.fireEvent("load",t)},onEnable:function(){var e=this;e.callParent();e.fromField.enable();e.toField.enable();Ext4.Array.forEach(e.query("[navBtn]"),function(e){e.enable()})},onDisable:function(){var e=this;e.callParent();e.fromField.disable();e.toField.disable();Ext4.Array.forEach(e.query("[navBtn]"),function(e){e.disable()})},onDestroy:function(){this.bindStore(null);this.callParent()}});Ext4.define("Ext4.ux.form.SearchField",{extend:"Ext4.form.field.Trigger",alias:"widget.searchfield",trigger1Cls:Ext4.baseCSSPrefix+"form-clear-trigger",trigger2Cls:Ext4.baseCSSPrefix+"form-search-trigger",hasSearch:false,paramName:"query",initComponent:function(){var e=this;e.callParent(arguments);e.on("specialkey",function(t,n){if(n.getKey()==n.ENTER){e.onTrigger2Click()}});e.store.remoteFilter=true;if(!e.store.proxy.hasOwnProperty("filterParam")){e.store.proxy.filterParam=e.paramName}e.store.proxy.encodeFilters=function(e){return e[0].value}},afterRender:function(){this.callParent();this.triggerCell.item(0).setDisplayed(false)},onTrigger1Click:function(){var e=this;if(e.hasSearch){e.setValue("");e.store.clearFilter();e.hasSearch=false;e.triggerCell.item(0).setDisplayed(false);e.updateLayout()}},onTrigger2Click:function(){var e=this,t=e.getValue();if(t.length>0){e.store.filter({id:e.paramName,property:e.paramName,value:t});e.hasSearch=true;e.triggerCell.item(0).setDisplayed(true);e.updateLayout()}}});Ext4.define("Ext4.ux.ToolbarDroppable",{constructor:function(e){Ext4.apply(this,e)},init:function(e){this.toolbar=e;this.toolbar.on({scope:this,render:this.createDropTarget})},createDropTarget:function(){this.dropTarget=Ext4.create("Ext4.dd.DropTarget",this.toolbar.getEl(),{notifyOver:Ext4.Function.bind(this.notifyOver,this),notifyDrop:Ext4.Function.bind(this.notifyDrop,this)})},addDDGroup:function(e){this.dropTarget.addToGroup(e)},calculateEntryIndex:function(e){var t=0,n=this.toolbar,r=n.items.items,i=r.length,s=e.getXY()[0],o=0,u,a,f,l;for(;o<i;o++){u=r[o].getEl();a=u.getXY()[0];f=u.getWidth();l=a+f/2;if(s<l){t=o;break}else{t=o+1}}return t},canDrop:function(e){return true},notifyOver:function(e,t,n){return this.canDrop.apply(this,arguments)?this.dropTarget.dropAllowed:this.dropTarget.dropNotAllowed},notifyDrop:function(e,t,n){var r=this.canDrop(e,t,n),i=this.toolbar;if(r){var s=this.calculateEntryIndex(t);i.insert(s,this.createItem(n));i.doLayout();this.afterLayout()}return r},createItem:function(e){Ext4.Error.raise("The createItem method must be implemented in the ToolbarDroppable plugin")},afterLayout:Ext4.emptyFn});Ext4.define("Ext4.ux.GroupTabPanel",{extend:"Ext4.Container",alias:"widget.grouptabpanel",requires:["Ext4.data.*","Ext4.tree.*","Ext4.layout.*"],baseCls:Ext4.baseCSSPrefix+"grouptabpanel",initComponent:function(e){var t=this;Ext4.apply(t,e);t.store=t.createTreeStore();t.layout={type:"hbox",align:"stretch"};t.defaults={border:false};t.items=[{xtype:"treepanel",cls:"x-tree-panel x-grouptabbar",width:150,rootVisible:false,store:t.store,hideHeaders:true,animate:false,processEvent:Ext4.emptyFn,viewConfig:{overItemCls:"",getRowClass:t.getRowClass,itemSelector:"div."+Ext4.baseCSSPrefix+"grouptab-row",cellSelector:"div."+Ext4.baseCSSPrefix+"grouptab",getTableChunker:function(){return Ext4.ux.GroupTreeChunker},onHeaderResize:function(e,t,n){var r=this,i=r.el;if(i){i.select("div."+Ext4.baseCSSPrefix+"grid-table-resizer").setWidth(r.headerCt.getFullWidth());if(!r.ignoreTemplate){r.setNewTemplate()}if(!n){r.el.focus()}r.forceReflow()}}},columns:[{xtype:"treecolumn",sortable:false,dataIndex:"text",flex:1,renderer:function(e,t,n,r,i,s,o){var u="";if(n.parentNode&&n.parentNode.parentNode===null){u+=" x-grouptab-first";if(n.previousSibling){u+=" x-grouptab-prev"}if(!n.get("expanded")||n.firstChild==null){u+=" x-grouptab-last"}}else if(n.nextSibling===null){u+=" x-grouptab-last"}else{u+=" x-grouptab-center"}if(n.data.activeTab){u+=" x-active-tab"}t.tdCls="x-grouptab"+u;return e}}]},{xtype:"container",flex:1,layout:"card",activeItem:t.mainItem,baseCls:Ext4.baseCSSPrefix+"grouptabcontainer",items:t.cards}];t.addEvents("beforetabchange","tabchange","beforegroupchange","groupchange");t.callParent(arguments);t.setActiveTab(t.activeTab);t.setActiveGroup(t.activeGroup);t.mon(t.down("treepanel").getSelectionModel(),"select",t.onNodeSelect,t)},getRowClass:function(e,t,n,r){var i="";if(e.data.activeGroup){i+=" x-active-group"}return i},onNodeSelect:function(e,t){var n=this,r=n.store.getRootNode(),i;if(t.parentNode&&t.parentNode.parentNode===null){i=t}else{i=t.parentNode}if(n.setActiveGroup(i.get("id"))===false||n.setActiveTab(t.get("id"))===false){return false}while(r){r.set("activeTab",false);r.set("activeGroup",false);r=r.firstChild||r.nextSibling||r.parentNode.nextSibling}i.set("activeGroup",true);i.eachChild(function(e){e.set("activeGroup",true)});t.set("activeTab",true);e.view.refresh()},setActiveTab:function(e){var t=this,n=e,r;if(Ext4.isString(e)){n=Ext4.getCmp(n)}if(n===t.activeTab){return false}r=t.activeTab;if(t.fireEvent("beforetabchange",t,n,r)!==false){t.activeTab=n;if(t.rendered){t.down("container[baseCls="+Ext4.baseCSSPrefix+"grouptabcontainer"+"]").getLayout().setActiveItem(n)}t.fireEvent("tabchange",t,n,r)}return true},setActiveGroup:function(e){var t=this,n=e,r;if(Ext4.isString(e)){n=Ext4.getCmp(n)}if(n===t.activeGroup){return true}r=t.activeGroup;if(t.fireEvent("beforegroupchange",t,n,r)!==false){t.activeGroup=n;t.fireEvent("groupchange",t,n,r)}else{return false}return true},createTreeStore:function(){var e=this,t=e.prepareItems(e.items),n={text:".",children:[]},r=e.cards=[];e.activeGroup=e.activeGroup||0;Ext4.each(t,function(t,i){var s=t.items.items,o=s[t.mainItem]||s[0],u={children:[]};u.id=o.id;u.text=o.title;u.iconCls=o.iconCls;u.expanded=true;u.activeGroup=e.activeGroup===i;u.activeTab=u.activeGroup?true:false;if(u.activeTab){e.activeTab=u.id}if(u.activeGroup){e.mainItem=t.mainItem||0;e.activeGroup=u.id}Ext4.each(s,function(e){if(e.id!==u.id){var t={id:e.id,leaf:true,text:e.title,iconCls:e.iconCls,activeGroup:u.activeGroup,activeTab:false};u.children.push(t)}delete e.title;delete e.iconCls;r.push(e)});n.children.push(u)});return Ext4.create("Ext4.data.TreeStore",{fields:["id","text","activeGroup","activeTab"],root:{expanded:true},proxy:{type:"memory",data:n}})},getActiveTab:function(){return this.activeTab},getActiveGroup:function(){return this.activeGroup}});Ext4.define("Ext4.ux.GroupTreeChunker",{singleton:true,requires:["Ext4.XTemplate"],metaTableTpl:["{%if (this.openTableWrap)out.push(this.openTableWrap())%}",'<table class="'+Ext4.baseCSSPrefix+'grid-table-resizer" border="0" cellspacing="0" cellpadding="0" {[this.embedFullWidth(values)]}><tr><td>',"{[this.openRows()]}","{row}","{[this.closeRows()]}","</td></tr><table>","{%if (this.closeTableWrap)out.push(this.closeTableWrap())%}"],constructor:function(){Ext4.XTemplate.prototype.recurse=function(e,t){return this.apply(t?e[t]:e)}},embedFullWidth:function(e){var t='style="width:{fullWidth}px;';if(!e.rowCount){t+="height:1px;"}return t+'"'},openRows:function(){return'<tpl for="rows">'},closeRows:function(){return"</tpl>"},metaRowTpl:['<div class="'+Ext4.baseCSSPrefix+'grouptab-row {[this.embedRowCls()]}" {[this.embedRowAttr()]}>','<tpl for="columns">','<div class="{cls} '+Ext4.baseCSSPrefix+"grouptab-cell "+Ext4.baseCSSPrefix+'grid-cell-{columnId} {{id}-modified} {{id}-tdCls} {[this.firstOrLastCls(xindex, xcount)]}" {{id}-tdAttr}>','<div {unselectableAttr} class="'+Ext4.baseCSSPrefix+'grid-cell-inner {unselectableCls}" style="text-align: {align}; {{id}-style};">{{id}}</div>','<div class="x-grouptabs-corner x-grouptabs-corner-top-left" id="ext-gen25"></div>','<div class="x-grouptabs-corner x-grouptabs-corner-bottom-left" id="ext-gen26"></div>',"</div>","</tpl>","</div>"],firstOrLastCls:function(e,t){if(e===1){return Ext4.view.Table.prototype.firstCls}else if(e===t){return Ext4.view.Table.prototype.lastCls}},embedRowCls:function(){return"{rowCls}"},embedRowAttr:function(){return"{rowAttr}"},getTableTpl:function(e,t){var n,r={openRows:this.openRows,closeRows:this.closeRows,embedFullWidth:this.embedFullWidth},i={},s=e.features||[],o=s.length,u=0,a={embedRowCls:this.embedRowCls,embedRowAttr:this.embedRowAttr,firstOrLastCls:this.firstOrLastCls,unselectableAttr:e.enableTextSelection?"":'unselectable="on"',unselectableCls:e.enableTextSelection?"":Ext4.baseCSSPrefix+"unselectable"},f=Array.prototype.slice.call(this.metaRowTpl,0),l;for(;u<o;u++){if(!s[u].disabled){s[u].mutateMetaRowTpl(f);Ext4.apply(a,s[u].getMetaRowTplFragments());Ext4.apply(i,s[u].getFragmentTpl());Ext4.apply(r,s[u].getTableFragments())}}f=new Ext4.XTemplate(f.join(""),a);e.row=f.applyTemplate(e);l=new Ext4.XTemplate(this.metaTableTpl.join(""),r);n=l.applyTemplate(e);if(!t){n=new Ext4.XTemplate(n,i)}return n}});Ext4.define("Ext4.ux.Spotlight",{baseCls:"x-spotlight",animate:true,duration:250,easing:null,active:false,constructor:function(e){Ext4.apply(this,e)},createElements:function(){var e=this,t=e.baseCls,n=Ext4.getBody();e.right=n.createChild({cls:t});e.left=n.createChild({cls:t});e.top=n.createChild({cls:t});e.bottom=n.createChild({cls:t});e.all=Ext4.create("Ext4.CompositeElement",[e.right,e.left,e.top,e.bottom])},show:function(e,t,n){var r=this;r.el=Ext4.get(e);if(!r.right){r.createElements()}if(!r.active){r.all.setDisplayed("");r.active=true;Ext4.EventManager.onWindowResize(r.syncSize,r);r.applyBounds(r.animate,false)}else{r.applyBounds(false,false)}},hide:function(e,t){var n=this;Ext4.EventManager.removeResizeListener(n.syncSize,n);n.applyBounds(n.animate,true)},syncSize:function(){this.applyBounds(false,false)},applyBounds:function(e,t){var n=this,r=n.el.getBox(),i=Ext4.Element.getViewWidth(true),s=Ext4.Element.getViewHeight(true),o=0,u=false,a,f,l;a={right:{x:r.right,y:s,width:i-r.right,height:0},left:{x:0,y:0,width:r.x,height:0},top:{x:i,y:0,width:0,height:r.y},bottom:{x:0,y:r.y+r.height,width:0,height:s-(r.y+r.height)+"px"}};f={right:{x:r.right,y:r.y,width:i-r.right+"px",height:s-r.y+"px"},left:{x:0,y:0,width:r.x+"px",height:r.y+r.height+"px"},top:{x:r.x,y:0,width:i-r.x+"px",height:r.y+"px"},bottom:{x:0,y:r.y+r.height,width:r.x+r.width+"px",height:s-(r.y+r.height)+"px"}};if(t){l=Ext4.clone(a);a=f;f=l}if(e){Ext4.Array.forEach(["right","left","top","bottom"],function(e){n[e].setBox(a[e]);n[e].animate({duration:n.duration,easing:n.easing,to:f[e]})},this)}else{Ext4.Array.forEach(["right","left","top","bottom"],function(e){n[e].setBox(Ext4.apply(a[e],f[e]));n[e].repaint()},this)}},destroy:function(){var e=this;Ext4.destroy(e.right,e.left,e.top,e.bottom);delete e.el;delete e.all}});Ext4.define("Ext4.ux.TabReorderer",{extend:"Ext4.ux.BoxReorderer",itemSelector:".x-tab",init:function(e){var t=this;t.callParent([e.getTabBar()]);e.onAdd=Ext4.Function.createSequence(e.onAdd,t.onAdd)},afterFirstLayout:function(){var e,t,n=0,r;this.callParent(arguments);for(e=this.container.items.items,t=e.length;n<t;n++){r=e[n];if(r.card){r.reorderable=r.card.reorderable}}},onAdd:function(e,t){e.tab.reorderable=e.reorderable},afterBoxReflow:function(){var e=this;Ext4.ux.BoxReorderer.prototype.afterBoxReflow.apply(e,arguments);if(e.dragCmp){e.container.tabPanel.setActiveTab(e.dragCmp.card);e.container.tabPanel.move(e.startIndex,e.curIndex)}}});Ext4.define("Ext4.ux.BoxReorderer",{mixins:{observable:"Ext4.util.Observable"},itemSelector:".x-box-item",animate:100,constructor:function(){this.addEvents("StartDrag","Drag","ChangeIndex","Drop");this.mixins.observable.constructor.apply(this,arguments)},init:function(e){var t=this;t.container=e;t.animatePolicy={};t.animatePolicy[e.getLayout().names.x]=true;t.container.on({scope:t,boxready:t.afterFirstLayout,destroy:t.onContainerDestroy})},onContainerDestroy:function(){if(this.dd){this.dd.unreg()}},afterFirstLayout:function(){var e=this,t=e.container.getLayout(),n=t.names,r;r=e.dd=Ext4.create("Ext4.dd.DD",t.innerCt,e.container.id+"-reorderer");Ext4.apply(r,{animate:e.animate,reorderer:e,container:e.container,getDragCmp:this.getDragCmp,clickValidator:Ext4.Function.createInterceptor(r.clickValidator,e.clickValidator,e,false),onMouseDown:e.onMouseDown,startDrag:e.startDrag,onDrag:e.onDrag,endDrag:e.endDrag,getNewIndex:e.getNewIndex,doSwap:e.doSwap,findReorderable:e.findReorderable});r.dim=n.width;r.startAttr=n.left;r.endAttr=n.right},getDragCmp:function(e){return this.container.getChildByElement(e.getTarget(this.itemSelector,10))},clickValidator:function(e){var t=this.getDragCmp(e);return!!(t&&t.reorderable!==false)},onMouseDown:function(e){var t=this,n=t.container,r,i,s;t.dragCmp=t.getDragCmp(e);if(t.dragCmp){i=t.dragCmp.getEl();t.startIndex=t.curIndex=n.items.indexOf(t.dragCmp);s=i.getPageBox();t.lastPos=s[this.startAttr];r=n.el.getPageBox();if(t.dim==="width"){t.minX=r.left;t.maxX=r.right-s.width;t.minY=t.maxY=s.top;t.deltaX=e.getPageX()-s.left}else{t.minY=r.top;t.maxY=r.bottom-s.height;t.minX=t.maxX=s.left;t.deltaY=e.getPageY()-s.top}t.constrainY=t.constrainX=true}},startDrag:function(){var e=this,t=e.dragCmp;if(t){t.setPosition=Ext4.emptyFn;t.animate=false;if(e.animate){e.container.getLayout().animatePolicy=e.reorderer.animatePolicy}e.dragElId=t.getEl().id;e.reorderer.fireEvent("StartDrag",e,e.container,t,e.curIndex);t.suspendEvents();t.disabled=true;t.el.setStyle("zIndex",100)}else{e.dragElId=null}},findReorderable:function(e){var t=this,n=t.container.items,r;if(n.getAt(e).reorderable===false){r=n.getAt(e);if(e>t.startIndex){while(r&&r.reorderable===false){e++;r=n.getAt(e)}}else{while(r&&r.reorderable===false){e--;r=n.getAt(e)}}}e=Math.min(Math.max(e,0),n.getCount()-1);if(n.getAt(e).reorderable===false){return-1}return e},doSwap:function(e){var t=this,n=t.container.items,r=t.container,i=t.container._isLayoutRoot,s,o,u,a;e=t.findReorderable(e);if(e===-1){return}t.reorderer.fireEvent("ChangeIndex",t,r,t.dragCmp,t.startIndex,e);s=n.getAt(t.curIndex);o=n.getAt(e);n.remove(s);u=Math.min(Math.max(e,0),n.getCount()-1);n.insert(u,s);n.remove(o);n.insert(t.curIndex,o);r._isLayoutRoot=true;r.updateLayout();r._isLayoutRoot=i;t.curIndex=e},onDrag:function(e){var t=this,n;n=t.getNewIndex(e.getPoint());if(n!==undefined){t.reorderer.fireEvent("Drag",t,t.container,t.dragCmp,t.startIndex,t.curIndex);t.doSwap(n)}},endDrag:function(e){if(e){e.stopEvent()}var t=this,n=t.container.getLayout(),r;if(t.dragCmp){delete t.dragElId;delete t.dragCmp.setPosition;t.dragCmp.animate=true;t.dragCmp.lastBox[n.names.x]=t.dragCmp.getPosition(true)[n.names.widthIndex];t.container._isLayoutRoot=true;t.container.updateLayout();t.container._isLayoutRoot=undefined;r=Ext4.fx.Manager.getFxQueue(t.dragCmp.el.id)[0];if(r){r.on({afteranimate:t.reorderer.afterBoxReflow,scope:t})}else{Ext4.Function.defer(t.reorderer.afterBoxReflow,1,t)}if(t.animate){delete n.animatePolicy}t.reorderer.fireEvent("drop",t,t.container,t.dragCmp,t.startIndex,t.curIndex)}},afterBoxReflow:function(){var e=this;e.dragCmp.el.setStyle("zIndex","");e.dragCmp.disabled=false;e.dragCmp.resumeEvents()},getNewIndex:function(e){var t=this,n=t.getDragEl(),r=Ext4.fly(n).getPageBox(),i,s,o,u=0,a=t.container.items.items,f=a.length,l=t.lastPos;t.lastPos=r[t.startAttr];for(;u<f;u++){i=a[u].getEl();if(i.is(t.reorderer.itemSelector)){s=i.getPageBox();o=s[t.startAttr]+(s[t.dim]>>1);if(u<t.curIndex){if(r[t.startAttr]<l&&r[t.startAttr]<o-5){return u}}else if(u>t.curIndex){if(r[t.startAttr]>l&&r[t.endAttr]>o+5){return u}}}}}});Ext4.ux.DataViewTransition=Ext4.extend(Object,{defaults:{duration:750,idProperty:"id"},constructor:function(e){Ext4.apply(this,e||{},this.defaults)},init:function(e){this.dataview=e;var t=this.idProperty;e.blockRefresh=true;e.updateIndexes=Ext4.Function.createSequence(e.updateIndexes,function(){this.getTargetEl().select(this.itemSelector).each(function(n,r,i){n.id=n.dom.id=Ext4.util.Format.format("{0}-{1}",e.id,e.store.getAt(i).get(t))},this)},e);this.dataviewID=e.id;this.cachedStoreData={};this.cacheStoreData(e.store.snapshot);e.store.on("datachanged",function(n){var r=e.getTargetEl(),i=n.getAt(0),s=this.getAdded(n),o=this.getRemoved(n),u=this.getRemaining(n),a=Ext4.apply({},u,s);Ext4.each(o,function(e){Ext4.fly(this.dataviewID+"-"+e.get(this.idProperty)).animate({remove:false,duration:S,opacity:0,useDisplay:true})},this);if(i==undefined){this.cacheStoreData(n);return}var f=Ext4.get(this.dataviewID+"-"+i.get(this.idProperty));var l=n.getCount(),c=f.getMargin("lr")+f.getWidth(),h=f.getMargin("bt")+f.getHeight(),p=r.getWidth(),d=Math.floor(p/c),v=Math.ceil(l/d),m=Math.ceil(this.getExistingCount()/d);r.applyStyles({display:"block",position:"relative"});var g={},y={},b={};Ext4.iterate(u,function(e,t){var e=t.get(this.idProperty),n=b[e]=Ext4.get(this.dataviewID+"-"+e);g[e]={top:n.getTop()-r.getTop()-n.getMargin("t")-r.getPadding("t"),left:n.getLeft()-r.getLeft()-n.getMargin("l")-r.getPadding("l")}},this);Ext4.iterate(u,function(e,t){var n=g[e],r=b[e];if(r.getStyle("position")!="absolute"){b[e].applyStyles({position:"absolute",left:n.left+"px",top:n.top+"px",width:r.getWidth(!Ext4.isIE||Ext4.isStrict),height:r.getHeight(!Ext4.isIE||Ext4.isStrict)})}});var w=0;Ext4.iterate(n.data.items,function(e){var n=e.get(t),r=b[n];var i=w%d,s=Math.floor(w/d),o=s*h,u=i*c;y[n]={top:o,left:u};w++},this);var E=new Date,S=this.duration,x=this.dataviewID;var T=function(){var e=new Date-E,t=e/S;if(t>=1){for(var n in y){Ext4.fly(x+"-"+n).applyStyles({top:y[n].top+"px",left:y[n].left+"px"})}Ext4.TaskManager.stop(N)}else{for(var n in y){if(!u[n])continue;var r=g[n],i=y[n],s=r.top,o=i.top,a=r.left,f=i.left,l=t*Math.abs(s-o),c=t*Math.abs(a-f),h=s>o?s-l:s+l,p=a>f?a-c:a+c;Ext4.fly(x+"-"+n).applyStyles({top:h+"px",left:p+"px"})}}};var N={run:T,interval:20,scope:this};Ext4.TaskManager.start(N);var C=0;for(var k in s){C++}if(Ext4.global.console&&Ext4.global.console.log){Ext4.global.console.log("added:",C)}Ext4.iterate(s,function(e,t){Ext4.fly(this.dataviewID+"-"+t.get(this.idProperty)).applyStyles({top:y[t.get(this.idProperty)].top+"px",left:y[t.get(this.idProperty)].left+"px"});Ext4.fly(this.dataviewID+"-"+t.get(this.idProperty)).animate({remove:false,duration:S,opacity:1})},this);this.cacheStoreData(n)},this)},cacheStoreData:function(e){this.cachedStoreData={};e.each(function(e){this.cachedStoreData[e.get(this.idProperty)]=e},this)},getExisting:function(){return this.cachedStoreData},getExistingCount:function(){var e=0,t=this.getExisting();for(var n in t)e++;return e},getAdded:function(e){var t={};e.each(function(e){if(this.cachedStoreData[e.get(this.idProperty)]==undefined){t[e.get(this.idProperty)]=e}},this);return t},getRemoved:function(e){var t=[];for(var n in this.cachedStoreData){if(e.findExact(this.idProperty,Number(n))==-1){t.push(this.cachedStoreData[n])}}return t},getRemaining:function(e){var t={};e.each(function(e){if(this.cachedStoreData[e.get(this.idProperty)]!=undefined){t[e.get(this.idProperty)]=e}},this);return t}});Ext4.define("Ext4.ux.DataView.Animated",{defaults:{duration:750,idProperty:"id"},constructor:function(e){Ext4.apply(this,e||{},this.defaults)},init:function(e){function r(t){var n=e.getTargetEl(),r=t.getAt(0),i=this.getAdded(t),s=this.getRemoved(t),o=this.getRemaining(t),u=Ext4.apply({},o,i);Ext4.each(s,function(e){var t=this.dataviewID+"-"+e.internalId;Ext4.fly(t).animate({remove:false,duration:E,opacity:0,useDisplay:true,callback:function(){Ext4.fly(t).setDisplayed(false)}})},this);if(r==undefined){this.cacheStoreData(t);return}this.cacheStoreData(t);var a=Ext4.get(this.dataviewID+"-"+r.internalId);if(!a){e.refresh();return true}var f=t.getCount(),l=a.getMargin("lr")+a.getWidth(),c=a.getMargin("bt")+a.getHeight(),h=n.getWidth(),p=Math.floor(h/l),d=Math.ceil(f/p),v=Math.ceil(this.getExistingCount()/p);var m={},g={},y={};Ext4.iterate(o,function(e,t){var e=t.internalId,r=y[e]=Ext4.get(this.dataviewID+"-"+e);m[e]={top:r.getTop()-n.getTop()-r.getMargin("t")-n.getPadding("t"),left:r.getLeft()-n.getLeft()-r.getMargin("l")-n.getPadding("l")}},this);n.applyStyles({display:"block",position:"relative"});Ext4.iterate(o,function(e,t){var n=m[e],r=y[e];if(r.getStyle("position")!="absolute"){y[e].applyStyles({position:"absolute",left:n.left+"px",top:n.top+"px"})}});var b=0;Ext4.iterate(t.data.items,function(e){var t=e.internalId,n=y[t];var r=b%p,i=Math.floor(b/p),s=i*c,o=r*l;g[t]={top:s,left:o};b++},this);var w=new Date,E=this.duration,S=this.dataviewID;var x=function(){var e=new Date-w,t=e/E,n;if(t>=1){for(n in g){Ext4.fly(S+"-"+n).applyStyles({top:g[n].top+"px",left:g[n].left+"px"})}Ext4.TaskManager.stop(T)}else{for(n in g){if(!o[n]){continue}var r=m[n],i=g[n],s=r.top,u=i.top,a=r.left,f=i.left,l=t*Math.abs(s-u),c=t*Math.abs(a-f),h=s>u?s-l:s+l,p=a>f?a-c:a+c;Ext4.fly(S+"-"+n).applyStyles({top:h+"px",left:p+"px"}).setDisplayed(true)}}};var T={run:x,interval:20,scope:this};Ext4.TaskManager.start(T);Ext4.iterate(i,function(e,t){Ext4.fly(this.dataviewID+"-"+t.internalId).applyStyles({top:g[t.internalId].top+"px",left:g[t.internalId].left+"px"}).setDisplayed(true);Ext4.fly(this.dataviewID+"-"+t.internalId).animate({remove:false,duration:E,opacity:1})},this);this.cacheStoreData(t)}this.dataview=e;var t=this.idProperty,n=e.store;e.blockRefresh=true;e.updateIndexes=Ext4.Function.createSequence(e.updateIndexes,function(){this.getTargetEl().select(this.itemSelector).each(function(t,r,i){t.id=t.dom.id=Ext4.util.Format.format("{0}-{1}",e.id,n.getAt(i).internalId)},this)},e);this.dataviewID=e.id;this.cachedStoreData={};this.cacheStoreData(n.data||n.snapshot);e.on("resize",function(){var t=e.store;if(t.getCount()>0){}},this);e.store.on("datachanged",r,this)},cacheStoreData:function(e){this.cachedStoreData={};e.each(function(e){this.cachedStoreData[e.internalId]=e},this)},getExisting:function(){return this.cachedStoreData},getExistingCount:function(){var e=0,t=this.getExisting();for(var n in t){e++}return e},getAdded:function(e){var t={};e.each(function(e){if(this.cachedStoreData[e.internalId]==undefined){t[e.internalId]=e}},this);return t},getRemoved:function(e){var t=[],n;for(n in this.cachedStoreData){if(e.findBy(function(e){return e.internalId==n})==-1){t.push(this.cachedStoreData[n])}}return t},getRemaining:function(e){var t={};e.each(function(e){if(this.cachedStoreData[e.internalId]!=undefined){t[e.internalId]=e}},this);return t}});Ext4.define("Ext4.ux.DataView.LabelEditor",{extend:"Ext4.Editor",alignment:"tl-tl",completeOnEnter:true,cancelOnEsc:true,shim:false,autoSize:{width:"boundEl",height:"field"},labelSelector:"x-editable",requires:["Ext4.form.field.Text"],constructor:function(e){e.field=e.field||Ext4.create("Ext4.form.field.Text",{allowBlank:false,selectOnFocus:true});this.callParent([e])},init:function(e){this.view=e;this.mon(e,"render",this.bindEvents,this);this.on("complete",this.onSave,this)},bindEvents:function(){this.mon(this.view.getEl(),{click:{fn:this.onClick,scope:this}})},onClick:function(e,t){var n=this,r,i;if(Ext4.fly(t).hasCls(n.labelSelector)&&!n.editing&&!e.ctrlKey&&!e.shiftKey){e.stopEvent();r=n.view.findItemByChild(t);i=n.view.store.getAt(n.view.indexOf(r));n.startEdit(t,i.data[n.dataIndex]);n.activeRecord=i}else if(n.editing){n.field.blur();e.preventDefault()}},onSave:function(e,t){this.activeRecord.set(this.dataIndex,t)}});Ext4.define("Ext4.ux.DataView.Draggable",{requires:"Ext4.dd.DragZone",ghostCls:"x-dataview-draggable-ghost",ghostTpl:['<tpl for=".">',"{title}","</tpl>"],init:function(e,t){this.dataview=e;e.on("render",this.onRender,this);Ext4.apply(this,{itemSelector:e.itemSelector,ghostConfig:{}},t||{});Ext4.applyIf(this.ghostConfig,{itemSelector:"img",cls:this.ghostCls,tpl:this.ghostTpl})},onRender:function(){var e=Ext4.apply({},this.ddConfig||{},{dvDraggable:this,dataview:this.dataview,getDragData:this.getDragData,getTreeNode:this.getTreeNode,afterRepair:this.afterRepair,getRepairXY:this.getRepairXY});this.dragZone=Ext4.create("Ext4.dd.DragZone",this.dataview.getEl(),e)},getDragData:function(e){var t=this.dvDraggable,n=this.dataview,r=n.getSelectionModel(),i=e.getTarget(t.itemSelector),s,o;if(i){if(!n.isSelected(i)){r.select(n.getRecord(i))}s=n.getSelectedNodes();o={copy:true,nodes:s,records:r.getSelection(),item:true};if(s.length==1){o.single=true;o.ddel=i}else{o.multi=true;o.ddel=t.prepareGhost(r.getSelection()).dom}return o}return false},getTreeNode:function(){},afterRepair:function(){this.dragging=false;var e=this.dragData.nodes,t=e.length,n;for(n=0;n<t;n++){Ext4.get(e[n]).frame("#8db2e3",1)}},getRepairXY:function(e){if(this.dragData.multi){return false}else{var t=Ext4.get(this.dragData.ddel),n=t.getXY();n[0]+=t.getPadding("t")+t.getMargin("t");n[1]+=t.getPadding("l")+t.getMargin("l");return n}},prepareGhost:function(e){var t=this.createGhost(e),n=t.store;n.removeAll();n.add(e);return t.getEl()},createGhost:function(e){if(!this.ghost){var t=Ext4.apply({},this.ghostConfig,{store:Ext4.create("Ext4.data.Store",{model:e[0].modelName})});this.ghost=Ext4.create("Ext4.view.View",t);this.ghost.render(document.createElement("div"))}return this.ghost}});Ext4.define("Ext4.ux.DataView.DragSelector",{requires:["Ext4.dd.DragTracker","Ext4.util.Region"],init:function(e){this.dataview=e;e.mon(e,{beforecontainerclick:this.cancelClick,scope:this,render:{fn:this.onRender,scope:this,single:true}})},onRender:function(){this.tracker=Ext4.create("Ext4.dd.DragTracker",{dataview:this.dataview,el:this.dataview.el,dragSelector:this,onBeforeStart:this.onBeforeStart,onStart:this.onStart,onDrag:this.onDrag,onEnd:this.onEnd});this.dragRegion=Ext4.create("Ext4.util.Region")},onBeforeStart:function(e){return e.target==this.dataview.getEl().dom},onStart:function(e){var t=this.dragSelector,n=this.dataview;this.dragging=true;t.fillRegions();t.getProxy().show();n.getSelectionModel().deselectAll()},cancelClick:function(){return!this.tracker.dragging},onDrag:function(e){var t=this.dragSelector,n=t.dataview.getSelectionModel(),r=t.dragRegion,i=t.bodyRegion,s=t.getProxy(),o=t.regions,u=o.length,a=this.startXY,f=this.getXY(),l=Math.min(a[0],f[0]),c=Math.min(a[1],f[1]),h=Math.abs(a[0]-f[0]),p=Math.abs(a[1]-f[1]),d,v,m;Ext4.apply(r,{top:c,left:l,right:l+h,bottom:c+p});r.constrainTo(i);s.setRegion(r);for(m=0;m<u;m++){d=o[m];v=r.intersect(d);if(v){n.select(m,true)}else{n.deselect(m)}}},onEnd:Ext4.Function.createDelayed(function(e){var t=this.dataview,n=t.getSelectionModel(),r=this.dragSelector;this.dragging=false;r.getProxy().hide()},1),getProxy:function(){if(!this.proxy){this.proxy=this.dataview.getEl().createChild({tag:"div",cls:"x-view-selector"})}return this.proxy},fillRegions:function(){var e=this.dataview,t=this.regions=[];e.all.each(function(e){t.push(e.getRegion())});this.bodyRegion=e.getEl().getRegion()}});Ext4.define("Ext4.ux.grid.filter.NumericFilter",{extend:"Ext4.ux.grid.filter.Filter",alias:"gridfilter.numeric",uses:["Ext4.form.field.Number"],createMenu:function(e){var t=this,n;n=Ext4.create("Ext4.ux.grid.menu.RangeMenu",e);n.on("update",t.fireUpdate,t);return n},getValue:function(){return this.menu.getValue()},setValue:function(e){this.menu.setValue(e)},isActivatable:function(){var e=this.getValue(),t;for(t in e){if(e[t]!==undefined){return true}}return false},getSerialArgs:function(){var e,t=[],n=this.menu.getValue();for(e in n){t.push({type:"numeric",comparison:e,value:n[e]})}return t},validateRecord:function(e){var t=e.get(this.dataIndex),n=this.getValue(),r=Ext4.isNumber;if(r(n.eq)&&t!=n.eq){return false}if(r(n.lt)&&t>=n.lt){return false}if(r(n.gt)&&t<=n.gt){return false}return true}});Ext4.define("Ext4.ux.grid.filter.Filter",{extend:"Ext4.util.Observable",active:false,dataIndex:null,menu:null,updateBuffer:500,constructor:function(e){Ext4.apply(this,e);this.addEvents("activate","deactivate","serialize","update");Ext4.ux.grid.filter.Filter.superclass.constructor.call(this);this.menu=this.createMenu(e);this.init(e);if(e&&e.value){this.setValue(e.value);this.setActive(e.active!==false,true);delete e.value}},destroy:function(){if(this.menu){this.menu.destroy()}this.clearListeners()},init:Ext4.emptyFn,createMenu:function(e){return Ext4.create("Ext4.menu.Menu",e)},getValue:Ext4.emptyFn,setValue:Ext4.emptyFn,isActivatable:function(){return true},getSerialArgs:Ext4.emptyFn,validateRecord:function(){return true},serialize:function(){var e=this.getSerialArgs();this.fireEvent("serialize",e,this);return e},fireUpdate:function(){if(this.active){this.fireEvent("update",this)}this.setActive(this.isActivatable())},setActive:function(e,t){if(this.active!=e){this.active=e;if(t!==true){this.fireEvent(e?"activate":"deactivate",this)}}}});Ext4.define("Ext4.ux.grid.filter.DateFilter",{extend:"Ext4.ux.grid.filter.Filter",alias:"gridfilter.date",uses:["Ext4.picker.Date","Ext4.menu.Menu"],afterText:"After",beforeText:"Before",compareMap:{before:"lt",after:"gt",on:"eq"},dateFormat:"m/d/Y",menuItems:["before","after","-","on"],menuItemCfgs:{selectOnFocus:true,width:125},onText:"On",pickerOpts:{},init:function(e){var t=this,n,r,i,s,o;n=Ext4.apply(t.pickerOpts,{xtype:"datepicker",minDate:t.minDate,maxDate:t.maxDate,format:t.dateFormat,listeners:{scope:t,select:t.onMenuSelect}});t.fields={};for(r=0,i=t.menuItems.length;r<i;r++){s=t.menuItems[r];if(s!=="-"){o={itemId:"range-"+s,text:t[s+"Text"],menu:Ext4.create("Ext4.menu.Menu",{items:[Ext4.apply(n,{itemId:s,listeners:{select:t.onPickerSelect,scope:t}})]}),listeners:{scope:t,checkchange:t.onCheckChange}};s=t.fields[s]=Ext4.create("Ext4.menu.CheckItem",o)}t.menu.add(s)}t.values={}},onCheckChange:function(e,t){var n=this,r=e.menu.items.first(),i=r.itemId,s=n.values;if(t){s[i]=r.getValue()}else{delete s[i]}n.setActive(n.isActivatable());n.fireEvent("update",n)},onInputKeyUp:function(e,t){var n=t.getKey();if(n==t.RETURN&&e.isValid()){t.stopEvent();this.menu.hide()}},onMenuSelect:function(e,t){var n=this.fields,r=this.fields[e.itemId];r.setChecked(true);if(r==n.on){n.before.setChecked(false,true);n.after.setChecked(false,true)}else{n.on.setChecked(false,true);if(r==n.after&&this.getFieldValue("before")<t){n.before.setChecked(false,true)}else if(r==n.before&&this.getFieldValue("after")>t){n.after.setChecked(false,true)}}this.fireEvent("update",this);e.up("menu").hide()},getValue:function(){var e,t={};for(e in this.fields){if(this.fields[e].checked){t[e]=this.getFieldValue(e)}}return t},setValue:function(e,t){var n;for(n in this.fields){if(e[n]){this.getPicker(n).setValue(e[n]);this.fields[n].setChecked(true)}else if(!t){this.fields[n].setChecked(false)}}this.fireEvent("update",this)},isActivatable:function(){var e;for(e in this.fields){if(this.fields[e].checked){return true}}return false},getSerialArgs:function(){var e=[];for(var t in this.fields){if(this.fields[t].checked){e.push({type:"date",comparison:this.compareMap[t],value:Ext4.Date.format(this.getFieldValue(t),this.dateFormat)})}}return e},getFieldValue:function(e){return this.values[e]},getPicker:function(e){return this.fields[e].menu.items.first()},validateRecord:function(e){var t,n,r=e.get(this.dataIndex),i=Ext4.Date.clearTime;if(!Ext4.isDate(r)){return false}r=i(r,true).getTime();for(t in this.fields){if(this.fields[t].checked){n=i(this.getFieldValue(t),true).getTime();if(t=="before"&&n<=r){return false}if(t=="after"&&n>=r){return false}if(t=="on"&&n!=r){return false}}}return true},onPickerSelect:function(e,t){this.values[e.itemId]=t;this.fireEvent("update",this)}});Ext4.define("Ext4.ux.grid.filter.StringFilter",{extend:"Ext4.ux.grid.filter.Filter",alias:"gridfilter.string",iconCls:"ux-gridfilter-text-icon",emptyText:"Enter Filter Text...",selectOnFocus:true,width:125,init:function(e){Ext4.applyIf(e,{enableKeyEvents:true,iconCls:this.iconCls,hideLabel:true,listeners:{scope:this,keyup:this.onInputKeyUp,el:{click:function(e){e.stopPropagation()}}}});this.inputItem=Ext4.create("Ext4.form.field.Text",e);this.menu.add(this.inputItem);this.updateTask=Ext4.create("Ext4.util.DelayedTask",this.fireUpdate,this)},getValue:function(){return this.inputItem.getValue()},setValue:function(e){this.inputItem.setValue(e);this.fireEvent("update",this)},isActivatable:function(){return this.inputItem.getValue().length>0},getSerialArgs:function(){return{type:"string",value:this.getValue()}},validateRecord:function(e){var t=e.get(this.dataIndex);if(typeof t!="string"){return this.getValue().length===0}return t.toLowerCase().indexOf(this.getValue().toLowerCase())>-1},onInputKeyUp:function(e,t){var n=t.getKey();if(n==t.RETURN&&e.isValid()){t.stopEvent();this.menu.hide();return}this.updateTask.delay(this.updateBuffer)}});Ext4.define("Ext4.ux.grid.filter.ListFilter",{extend:"Ext4.ux.grid.filter.Filter",alias:"gridfilter.list",phpMode:false,init:function(e){this.dt=Ext4.create("Ext4.util.DelayedTask",this.fireUpdate,this)},createMenu:function(e){var t=Ext4.create("Ext4.ux.grid.menu.ListMenu",e);t.on("checkchange",this.onCheckChange,this);return t},getValue:function(){return this.menu.getSelected()},setValue:function(e){this.menu.setSelected(e);this.fireEvent("update",this)},isActivatable:function(){return this.getValue().length>0},getSerialArgs:function(){return{type:"list",value:this.phpMode?this.getValue().join(","):this.getValue()}},onCheckChange:function(){this.dt.delay(this.updateBuffer)},validateRecord:function(e){var t=this.getValue();return Ext4.Array.indexOf(t,e.get(this.dataIndex))>-1}});Ext4.define("Ext4.ux.grid.filter.BooleanFilter",{extend:"Ext4.ux.grid.filter.Filter",alias:"gridfilter.boolean",defaultValue:false,yesText:"Yes",noText:"No",init:function(e){var t=Ext4.id();this.options=[Ext4.create("Ext4.menu.CheckItem",{text:this.yesText,group:t,checked:this.defaultValue===true}),Ext4.create("Ext4.menu.CheckItem",{text:this.noText,group:t,checked:this.defaultValue===false})];this.menu.add(this.options[0],this.options[1]);for(var n=0;n<this.options.length;n++){this.options[n].on("click",this.fireUpdate,this);this.options[n].on("checkchange",this.fireUpdate,this)}},getValue:function(){return this.options[0].checked},setValue:function(e){this.options[e?0:1].setChecked(true)},getSerialArgs:function(){var e={type:"boolean",value:this.getValue()};return e},validateRecord:function(e){return e.get(this.dataIndex)==this.getValue()}});Ext4.define("Ext4.ux.grid.TransformGrid",{extend:"Ext4.grid.Panel",constructor:function(e,t){t=Ext4.apply({},t);e=this.table=Ext4.get(e);var n=t.fields||[],r=t.columns||[],i=[],s=[],o=e.query("thead th"),u=0,a=o.length,f=e.dom,l,c,h,p,d,v;for(;u<a;++u){p=o[u];d=p.innerHTML;v="tcol-"+u;i.push(Ext4.applyIf(n[u]||{},{name:v,mapping:"td:nth("+(u+1)+")/@innerHTML"}));s.push(Ext4.applyIf(r[u]||{},{text:d,dataIndex:v,width:p.offsetWidth,tooltip:p.title,sortable:true}))}if(t.width){l=t.width}else{l=e.getWidth()+1}if(t.height){c=t.height}Ext4.applyIf(t,{store:{data:f,fields:i,proxy:{type:"memory",reader:{record:"tbody tr",type:"xml"}}},columns:s,width:l,height:c});this.callParent([t]);if(t.remove!==false){f.parentNode.removeChild(f)}},onDestroy:function(){this.callParent();this.table.remove();delete this.table}});Ext4.define("Ext4.ux.grid.menu.ListMenu",{extend:"Ext4.menu.Menu",labelField:"text",loadingText:"Loading...",loadOnShow:true,single:false,constructor:function(e){var t=this,n,r,i,s;t.selected=[];t.addEvents("checkchange");t.callParent([e=e||{}]);if(!e.store&&e.options){n=[];for(r=0,i=e.options.length;r<i;r++){s=e.options[r];switch(Ext4.type(s)){case"array":n.push(s);break;case"object":n.push([s.id,s[t.labelField]]);break;case"string":n.push([s,s]);break}}t.store=Ext4.create("Ext4.data.ArrayStore",{fields:["id",t.labelField],data:n,listeners:{load:t.onLoad,scope:t}});t.loaded=true;t.autoStore=true}else{t.add({text:t.loadingText,iconCls:"loading-indicator"});t.store.on("load",t.onLoad,t)}},destroy:function(){var e=this,t=e.store;if(t){if(e.autoStore){t.destroyStore()}else{t.un("unload",e.onLoad,e)}}e.callParent()},show:function(){if(this.loadOnShow&&!this.loaded&&!this.store.loading){this.store.load()}this.callParent()},onLoad:function(e,t){var n=this,r,i,s,o,u={checkchange:n.checkChange,scope:n};Ext4.suspendLayouts();n.removeAll(true);r=n.single?Ext4.id():null;for(s=0,o=t.length;s<o;s++){i=t[s].get("id");n.add(Ext4.create("Ext4.menu.CheckItem",{text:t[s].get(n.labelField),group:r,checked:Ext4.Array.contains(n.selected,i),hideOnClick:false,value:i,listeners:u}))}n.loaded=true;Ext4.resumeLayouts(true);n.fireEvent("load",n,t)},getSelected:function(){return this.selected},setSelected:function(e){e=this.selected=[].concat(e);if(this.loaded){this.items.each(function(t){t.setChecked(false,true);for(var n=0,r=e.length;n<r;n++){if(t.value==e[n]){t.setChecked(true,true)}}},this)}},checkChange:function(e,t){var n=[];this.items.each(function(e){if(e.checked){n.push(e.value)}},this);this.selected=n;this.fireEvent("checkchange",e,t)}});Ext4.define("Ext4.ux.grid.menu.RangeMenu",{extend:"Ext4.menu.Menu",fieldCls:"Ext4.form.field.Number",itemIconCls:{gt:"ux-rangemenu-gt",lt:"ux-rangemenu-lt",eq:"ux-rangemenu-eq"},fieldLabels:{gt:"Greater Than",lt:"Less Than",eq:"Equal To"},menuItemCfgs:{emptyText:"Enter Number...",selectOnFocus:false,width:155},menuItems:["lt","gt","-","eq"],constructor:function(e){var t=this,n,r,i,s,o,u,a;t.callParent(arguments);n=t.fields=t.fields||{};r=t.fieldCfg=t.fieldCfg||{};t.addEvents("update");t.updateTask=Ext4.create("Ext4.util.DelayedTask",t.fireUpdate,t);for(i=0,s=t.menuItems.length;i<s;i++){o=t.menuItems[i];if(o!=="-"){u={itemId:"range-"+o,enableKeyEvents:true,hideLabel:false,fieldLabel:t.iconTpl.apply({cls:t.itemIconCls[o]||"no-icon",text:t.fieldLabels[o]||"",src:Ext4.BLANK_IMAGE_URL}),labelSeparator:"",labelWidth:29,labelStyle:"position: relative;",listeners:{scope:t,change:t.onInputChange,keyup:t.onInputKeyUp,el:{click:function(e){e.stopPropagation()}}},activate:Ext4.emptyFn,deactivate:Ext4.emptyFn};Ext4.apply(u,Ext4.applyIf(n[o]||{},r[o]),t.menuItemCfgs);a=u.fieldCls||t.fieldCls;o=n[o]=Ext4.create(a,u)}t.add(o)}},fireUpdate:function(){this.fireEvent("update",this)},getValue:function(){var e={},t,n;for(t in this.fields){n=this.fields[t];if(n.isValid()&&n.getValue()!==null){e[t]=n.getValue()}}return e},setValue:function(e){var t=this,n,r;for(n in t.fields){r=t.fields[n];r.suspendEvents();r.setValue(n in e?e[n]:"");r.resumeEvents()}t.fireEvent("update",t)},onInputKeyUp:function(e,t){if(t.getKey()===t.RETURN&&e.isValid()){t.stopEvent();this.hide()}},onInputChange:function(e){var t=this,n=t.fields,r=n.eq,i=n.gt,s=n.lt;if(e==r){if(i){i.setValue(null)}if(s){s.setValue(null)}}else{r.setValue(null)}this.updateTask.delay(this.updateBuffer)}},function(){this.prototype.iconTpl=Ext4.create("Ext4.XTemplate",'<img src="{src}" alt="{text}" class="'+Ext4.baseCSSPrefix+'menu-item-icon ux-rangemenu-icon {cls}" />')});Ext4.define("Ext4.ux.grid.FiltersFeature",{extend:"Ext4.grid.feature.Feature",alias:"feature.filters",uses:["Ext4.ux.grid.menu.ListMenu","Ext4.ux.grid.menu.RangeMenu","Ext4.ux.grid.filter.BooleanFilter","Ext4.ux.grid.filter.DateFilter","Ext4.ux.grid.filter.ListFilter","Ext4.ux.grid.filter.NumericFilter","Ext4.ux.grid.filter.StringFilter"],autoReload:true,filterCls:"ux-filtered-column",local:false,menuFilterText:"Filters",paramPrefix:"filter",showMenu:true,stateId:undefined,updateBuffer:500,hasFeatureEvent:false,constructor:function(e){var t=this;e=e||{};Ext4.apply(t,e);t.deferredUpdate=Ext4.create("Ext4.util.DelayedTask",t.reload,t);t.filters=t.createFiltersCollection();t.filterConfigs=e.filters},attachEvents:function(){var e=this,t=e.view,n=t.headerCt,r=e.getGridPanel();e.bindStore(t.getStore(),true);n.on("menucreate",e.onMenuCreate,e);t.on("refresh",e.onRefresh,e);r.on({scope:e,beforestaterestore:e.applyState,beforestatesave:e.saveState,beforedestroy:e.destroy});r.filters=e;r.addEvents("filterupdate")},createFiltersCollection:function(){return Ext4.create("Ext4.util.MixedCollection",false,function(e){return e?e.dataIndex:null})},createFilters:function(){function f(e,t,n){if(e&&(n||t)){o=s.get(e);u={dataIndex:e,type:o&&o.type&&o.type.type||"auto"};if(Ext4.isObject(t)){Ext4.apply(u,t)}r.replace(u)}}var e=this,t=e.filters.getCount(),n=e.getGridPanel(),r=e.createFiltersCollection(),i=n.store.model,s=i.prototype.fields,o,u,a;if(t){a={};e.saveState(null,a)}Ext4.Array.each(e.filterConfigs,function(e){f(e.dataIndex,e)});Ext4.Array.each(n.columns,function(e){if(e.filterable===false){r.removeAtKey(e.dataIndex)}else{f(e.dataIndex,e.filter,e.filterable)}});e.removeAll();if(r.items){e.initializeFilters(r.items)}if(t){e.applyState(null,a)}},initializeFilters:function(e){var t=this,n=e.length,r,i,s;for(r=0;r<n;r++){i=e[r];if(i){s=t.getFilterClass(i.type);i=i.menu?i:new s(i);t.filters.add(i);Ext4.util.Observable.capture(i,this.onStateChange,this)}}},onMenuCreate:function(e,t){var n=this;n.createFilters();t.on("beforeshow",n.onMenuBeforeShow,n)},onMenuBeforeShow:function(e){var t=this,n,r;if(t.showMenu){n=t.menuItem;if(!n||n.isDestroyed){t.createMenuItem(e);n=t.menuItem}r=t.getMenuFilter();if(r){n.setMenu(r.menu,false);n.setChecked(r.active);n.setDisabled(r.disabled===true)}n.setVisible(!!r);this.sep.setVisible(!!r)}},createMenuItem:function(e){var t=this;t.sep=e.add("-");t.menuItem=e.add({checked:false,itemId:"filters",text:t.menuFilterText,listeners:{scope:t,checkchange:t.onCheckChange,beforecheckchange:t.onBeforeCheck}})},getGridPanel:function(){return this.view.up("gridpanel")},applyState:function(e,t){var n=this,r,i;n.applyingState=true;n.clearFilters();if(t.filters){for(r in t.filters){if(t.filters.hasOwnProperty(r)){i=n.filters.get(r);if(i){i.setValue(t.filters[r]);i.setActive(true)}}}}n.deferredUpdate.cancel();if(n.local){n.reload()}delete n.applyingState;delete t.filters},saveState:function(e,t){var n={};this.filters.each(function(e){if(e.active){n[e.dataIndex]=e.getValue()}});return t.filters=n},destroy:function(){var e=this;Ext4.destroyMembers(e,"menuItem","sep");e.removeAll();e.clearListeners()},removeAll:function(){if(this.filters){Ext4.destroy.apply(Ext4,this.filters.items);this.filters.clear()}},bindStore:function(e){var t=this;if(t.store&&t.storeListeners){t.store.un(t.storeListeners)}if(e){t.storeListeners={scope:t};if(t.local){t.storeListeners.load=t.onLoad}else{t.storeListeners["before"+(e.buffered?"prefetch":"load")]=t.onBeforeLoad}e.on(t.storeListeners)}else{delete t.storeListeners}t.store=e},getMenuFilter:function(){var e=this.view.headerCt.getMenu().activeHeader;return e?this.filters.get(e.dataIndex):null},onCheckChange:function(e,t){this.getMenuFilter().setActive(t)},onBeforeCheck:function(e,t){return!t||this.getMenuFilter().isActivatable()},onStateChange:function(e,t){if(e!=="serialize"){var n=this,r=n.getGridPanel();if(t==n.getMenuFilter()){n.menuItem.setChecked(t.active,false)}if((n.autoReload||n.local)&&!n.applyingState){n.deferredUpdate.delay(n.updateBuffer)}n.updateColumnHeadings();if(!n.applyingState){r.saveState()}r.fireEvent("filterupdate",n,t)}},onBeforeLoad:function(e,t){t.params=t.params||{};this.cleanParams(t.params);var n=this.buildQuery(this.getFilterData());Ext4.apply(t.params,n)},onLoad:function(e){e.filterBy(this.getRecordFilter())},onRefresh:function(){this.updateColumnHeadings()},updateColumnHeadings:function(){var e=this,t=e.view.headerCt;if(t){t.items.each(function(t){var n=e.getFilter(t.dataIndex);t[n&&n.active?"addCls":"removeCls"](e.filterCls)})}},reload:function(){var e=this,t=e.view.getStore();if(e.local){t.clearFilter(true);t.filterBy(e.getRecordFilter());t.sort()}else{e.deferredUpdate.cancel();if(t.buffered){t.pageMap.clear()}t.loadPage(1)}},getRecordFilter:function(){var e=[],t,n;this.filters.each(function(t){if(t.active){e.push(t)}});t=e.length;return function(r){for(n=0;n<t;n++){if(!e[n].validateRecord(r)){return false}}return true}},addFilter:function(e){var t=this,n=t.getGridPanel().columns,r,i,s,o,u;for(r=0,i=n.length;r<i;r++){s=n[r];if(s.dataIndex===e.dataIndex){s.filter=e}}if(t.view.headerCt.menu){t.createFilters()}else{t.view.headerCt.getMenu()}for(r=0,o=t.filters.items.length;r<o;r++){u=t.filters.items[r];if(u.dataIndex===e.dataIndex){return u}}},addFilters:function(e){if(e){var t=this,n,r;for(n=0,r=e.length;n<r;n++){t.addFilter(e[n])}}},getFilter:function(e){return this.filters.get(e)},clearFilters:function(){this.filters.each(function(e){e.setActive(false)})},getFilterData:function(){var e=[],t,n;this.filters.each(function(r){if(r.active){var s=[].concat(r.serialize());for(t=0,n=s.length;t<n;t++){e.push({field:r.dataIndex,data:s[t]})}}});return e},buildQuery:function(e){var t={},n,r,i,s,o,u,a=e.length;if(!this.encode){for(n=0;n<a;n++){r=e[n];i=[this.paramPrefix,"[",n,"]"].join("");t[i+"[field]"]=r.field;s=i+"[data]";for(o in r.data){t[[s,"[",o,"]"].join("")]=r.data[o]}}}else{u=[];for(n=0;n<a;n++){r=e[n];u.push(Ext4.apply({},{field:r.field},r.data))}if(u.length>0){t[this.paramPrefix]=Ext4.JSON.encode(u)}}return t},cleanParams:function(e){if(this.encode){delete e[this.paramPrefix]}else{var t,n;t=new RegExp("^"+this.paramPrefix+"[[0-9]+]");for(n in e){if(t.test(n)){delete e[n]}}}},getFilterClass:function(e){switch(e){case"auto":e="string";break;case"int":case"float":e="numeric";break;case"bool":e="boolean";break}return Ext4.ClassManager.getByAlias("gridfilter."+e)}});Ext4.define("Ext4.ux.LiveSearchGridPanel",{extend:"Ext4.grid.Panel",requires:["Ext4.toolbar.TextItem","Ext4.form.field.Checkbox","Ext4.form.field.Text","Ext4.ux.statusbar.StatusBar"],searchValue:null,indexes:[],currentIndex:null,searchRegExp:null,caseSensitive:false,regExpMode:false,matchCls:"x-livesearch-match",defaultStatusText:"Nothing Found",initComponent:function(){var e=this;e.tbar=["Search",{xtype:"textfield",name:"searchField",hideLabel:true,width:200,listeners:{change:{fn:e.onTextFieldChange,scope:this,buffer:100}}},{xtype:"button",text:"<",tooltip:"Find Previous Row",handler:e.onPreviousClick,scope:e},{xtype:"button",text:">",tooltip:"Find Next Row",handler:e.onNextClick,scope:e},"-",{xtype:"checkbox",hideLabel:true,margin:"0 0 0 4px",handler:e.regExpToggle,scope:e},"Regular expression",{xtype:"checkbox",hideLabel:true,margin:"0 0 0 4px",handler:e.caseSensitiveToggle,scope:e},"Case sensitive"];e.bbar=Ext4.create("Ext4.ux.StatusBar",{defaultText:e.defaultStatusText,name:"searchStatusBar"});e.callParent(arguments)},afterRender:function(){var e=this;e.callParent(arguments);e.textField=e.down("textfield[name=searchField]");e.statusBar=e.down("statusbar[name=searchStatusBar]")},tagsRe:/<[^>]*>/gm,tagsProtect:"",regExpProtect:/\\|\/|\+|\\|\.|\[|\]|\{|\}|\?|\$|\*|\^|\|/gm,getSearchValue:function(){var e=this,t=e.textField.getValue();if(t===""){return null}if(!e.regExpMode){t=t.replace(e.regExpProtect,function(e){return"\\"+e})}else{try{new RegExp(t)}catch(n){e.statusBar.setStatus({text:n.message,iconCls:"x-status-error"});return null}if(t==="^"||t==="$"){return null}}return t},onTextFieldChange:function(){var e=this,t=0;e.view.refresh();e.statusBar.setStatus({text:e.defaultStatusText,iconCls:""});e.searchValue=e.getSearchValue();e.indexes=[];e.currentIndex=null;if(e.searchValue!==null){e.searchRegExp=new RegExp(e.searchValue,"g"+(e.caseSensitive?"":"i"));e.store.each(function(n,r){var i=Ext4.fly(e.view.getNode(r)).down("td"),s,o,u;while(i){s=i.down(".x-grid-cell-inner");o=s.dom.innerHTML.match(e.tagsRe);u=s.dom.innerHTML.replace(e.tagsRe,e.tagsProtect);u=u.replace(e.searchRegExp,function(n){t+=1;if(Ext4.Array.indexOf(e.indexes,r)===-1){e.indexes.push(r)}if(e.currentIndex===null){e.currentIndex=r}return'<span class="'+e.matchCls+'">'+n+"</span>"});Ext4.each(o,function(t){u=u.replace(e.tagsProtect,t)});s.dom.innerHTML=u;i=i.next()}},e);if(e.currentIndex!==null){e.getSelectionModel().select(e.currentIndex);e.statusBar.setStatus({text:t+" matche(s) found.",iconCls:"x-status-valid"})}}if(e.currentIndex===null){e.getSelectionModel().deselectAll()}e.textField.focus()},onPreviousClick:function(){var e=this,t;if((t=Ext4.Array.indexOf(e.indexes,e.currentIndex))!==-1){e.currentIndex=e.indexes[t-1]||e.indexes[e.indexes.length-1];e.getSelectionModel().select(e.currentIndex)}},onNextClick:function(){var e=this,t;if((t=Ext4.Array.indexOf(e.indexes,e.currentIndex))!==-1){e.currentIndex=e.indexes[t+1]||e.indexes[0];e.getSelectionModel().select(e.currentIndex)}},caseSensitiveToggle:function(e,t){this.caseSensitive=t;this.onTextFieldChange()},regExpToggle:function(e,t){this.regExpMode=t;this.onTextFieldChange()}});Ext4.define("Ext4.ux.TreePicker",{extend:"Ext4.form.field.Picker",xtype:"treepicker",triggerCls:Ext4.baseCSSPrefix+"form-arrow-trigger",config:{store:null,displayField:null,columns:null,selectOnTab:true,maxPickerHeight:300,minPickerHeight:100},editable:false,initComponent:function(){var e=this;e.callParent(arguments);this.addEvents("select");e.store.on("load",e.onLoad,e)},createPicker:function(){var e=this,t=Ext4.create("Ext4.tree.Panel",{store:e.store,floating:true,hidden:true,displayField:e.displayField,columns:e.columns,maxHeight:e.maxTreeHeight,shadow:false,manageHeight:false,listeners:{itemclick:Ext4.bind(e.onItemClick,e)},viewConfig:{listeners:{render:function(t){t.getEl().on("keypress",e.onPickerKeypress,e)}}}}),n=t.getView();n.on("render",e.setPickerViewStyles,e);if(Ext4.isIE9&&Ext4.isStrict){n.on("highlightitem",e.repaintPickerView,e);n.on("unhighlightitem",e.repaintPickerView,e);n.on("afteritemexpand",e.repaintPickerView,e);n.on("afteritemcollapse",e.repaintPickerView,e)}return t},setPickerViewStyles:function(e){e.getEl().setStyle({"min-height":this.minPickerHeight+"px","max-height":this.maxPickerHeight+"px"})},repaintPickerView:function(){var e=this.picker.getView().getEl().dom.style;e.display=e.display},alignPicker:function(){var e=this,t;if(e.isExpanded){t=e.getPicker();if(e.matchFieldWidth){t.setWidth(e.bodyEl.getWidth())}if(t.isFloating()){e.doAlign()}}},onItemClick:function(e,t,n,r,i){this.selectItem(t)},onPickerKeypress:function(e,t){var n=e.getKey();if(n===e.ENTER||n===e.TAB&&this.selectOnTab){this.selectItem(this.picker.getSelectionModel().getSelection()[0])}},selectItem:function(e){var t=this;t.setValue(e.get("id"));t.picker.hide();t.inputEl.focus();t.fireEvent("select",t,e)},onExpand:function(){var e=this,t=e.picker,n=t.store,r=e.value;if(r){t.selectPath(n.getNodeById(r).getPath())}else{t.getSelectionModel().select(n.getRootNode())}Ext4.defer(function(){t.getView().focus()},1)},setValue:function(e){var t=this,n;t.value=e;if(t.store.loading){return t}n=e?t.store.getNodeById(e):t.store.getRootNode();t.setRawValue(n?n.get(this.displayField):"");return t},getValue:function(){return this.value},onLoad:function(){var e=this.value;if(e){this.setValue(e)}}});Ext4.ns("Ext4.ux");Ext4.define("Ext4.ux.TabScrollerMenu",{alias:"plugin.tabscrollermenu",requires:["Ext4.menu.Menu"],pageSize:10,maxText:15,menuPrefixText:"Items",constructor:function(e){Ext4.apply(this,e)},init:function(e){var t=this;t.tabPanel=e;e.on({render:function(){t.tabBar=e.tabBar;t.layout=t.tabBar.layout;t.layout.overflowHandler.handleOverflow=Ext4.Function.bind(t.showButton,t);t.layout.overflowHandler.clearOverflow=Ext4.Function.createSequence(t.layout.overflowHandler.clearOverflow,t.hideButton,t)},single:true})},showButton:function(){var e=this,t=Ext4.getClass(e.layout.overflowHandler).prototype.handleOverflow.apply(e.layout.overflowHandler,arguments);if(!e.menuButton){e.menuButton=e.tabBar.body.createChild({cls:Ext4.baseCSSPrefix+"tab-tabmenu-right"},e.tabBar.body.child("."+Ext4.baseCSSPrefix+"box-scroller-right"));e.menuButton.addClsOnOver(Ext4.baseCSSPrefix+"tab-tabmenu-over");e.menuButton.on("click",e.showTabsMenu,e)}e.menuButton.show();t.reservedSpace+=e.menuButton.getWidth();return t},hideButton:function(){var e=this;if(e.menuButton){e.menuButton.hide()}},getPageSize:function(){return this.pageSize},setPageSize:function(e){this.pageSize=e},getMaxText:function(){return this.maxText},setMaxText:function(e){this.maxText=e},getMenuPrefixText:function(){return this.menuPrefixText},setMenuPrefixText:function(e){this.menuPrefixText=e},showTabsMenu:function(e){var t=this;if(t.tabsMenu){t.tabsMenu.removeAll()}else{t.tabsMenu=new Ext4.menu.Menu;t.tabPanel.on("destroy",t.tabsMenu.destroy,t.tabsMenu)}t.generateTabMenuItems();var n=Ext4.get(e.getTarget()),r=n.getXY();r[1]+=24;t.tabsMenu.showAt(r)},generateTabMenuItems:function(){var e=this,t=e.tabPanel,n=t.getActiveTab(),r=t.items.getRange(),i=e.getPageSize(),s=e.tabsMenu,o,u,a,f,l,c,h,p,d,v;s.suspendLayouts();r=Ext4.Array.filter(r,function(e){if(e.id==n.id){return false}return e.hidden?!!e.hiddenByLayout:true});o=r.length;u=Math.floor(o/i);a=o%i;if(o>i){for(f=0;f<u;f++){l=(f+1)*i;c=[];for(h=0;h<i;h++){v=h+l-i;p=r[v];c.push(e.autoGenMenuItem(p))}s.add({text:e.getMenuPrefixText()+" "+(l-i+1)+" - "+l,menu:c})}if(a>0){d=u*i;c=[];for(f=d;f<o;f++){p=r[f];c.push(e.autoGenMenuItem(p))}e.tabsMenu.add({text:e.menuPrefixText+" "+(d+1)+" - "+(d+c.length),menu:c})}}else{for(f=0;f<o;++f){s.add(e.autoGenMenuItem(r[f]))}}s.resumeLayouts(true)},autoGenMenuItem:function(e){var t=this.getMaxText(),n=Ext4.util.Format.ellipsis(e.title,t);return{text:n,handler:this.showTabFromMenu,scope:this,disabled:e.disabled,tabToShow:e,iconCls:e.iconCls}},showTabFromMenu:function(e){this.tabPanel.setActiveTab(e.tabToShow)}});Ext4.define("Ext4.ux.event.Driver",{active:null,mixins:{observable:"Ext4.util.Observable"},constructor:function(e){var t=this;t.mixins.observable.constructor.apply(this,arguments);t.addEvents("start","stop")},getTime:function(){return(new Date).getTime()},getTimestamp:function(){var e=this.getTime();return e-this.startTime},onStart:function(){},onStop:function(){},start:function(){var e=this;if(!e.active){e.active=new Date;e.startTime=e.getTime();e.onStart();e.fireEvent("start",e)}},stop:function(){var e=this;if(e.active){e.active=null;e.onStop();e.fireEvent("stop",e)}}});Ext4.define("Ext4.ux.event.Maker",{eventQueue:[],startAfter:500,timerIncrement:500,currentTiming:0,constructor:function(e){var t=this;t.currentTiming=t.startAfter;if(!Ext4.isArray(e)){e=[e]}Ext4.Array.each(e,function(n){n.el=n.el||"el";Ext4.Array.each(Ext4.ComponentQuery.query(n.cmpQuery),function(r){var i={},s,o,u;if(!n.domQuery){u=r[n.el]}else{u=r.el.down(n.domQuery)}i.target="#"+u.dom.id;i.type=n.type;i.button=e.button||0;s=u.getX()+u.getWidth()/2;o=u.getY()+u.getHeight()/2;i.xy=[s,o];i.ts=t.currentTiming;t.currentTiming+=t.timerIncrement;t.eventQueue.push(i)});if(n.screenshot){t.eventQueue[t.eventQueue.length-1].screenshot=true}});return t.eventQueue}});Ext4.define("Ext4.ux.event.Player",{extend:"Ext4.ux.event.Driver",keyFrameEvents:{click:true},pauseForAnimations:true,speed:1,stallTime:0,tagPathRegEx:/(\w+)(?:\[(\d+)\])?/,constructor:function(e){var t=this;t.callParent(arguments);t.addEvents("beforeplay","keyframe");t.eventObject=new Ext4.EventObjectImpl;t.timerFn=function(){t.onTick()};t.attachTo=t.attachTo||window},getElementFromXPath:function(e){var t=this,n=e.split("/"),r=t.tagPathRegEx,i,s,o,u,a,f,l=t.attachTo.document;l=n[0]=="~"?l.body:l.getElementById(n[0].substring(1));for(i=1,s=n.length;l&&i<s;++i){o=r.exec(n[i]);u=o[2]?parseInt(o[2],10):1;a=o[1].toUpperCase();for(f=l.firstChild;f;f=f.nextSibling){if(f.tagName==a){if(u==1){break}--u}}l=f}return l},getTimeIndex:function(){var e=this.getTimestamp()-this.stallTime;return e*this.speed},makeToken:function(e,t){var n=this,r;e[t]=true;e.defer=function(){e[t]=false;r=n.getTime()};e.finish=function(){e[t]=true;n.stallTime+=n.getTime()-r;n.schedule()}},nextEvent:function(e){var t=this,n=++t.queueIndex;if(t.keyFrameEvents[e.type]){Ext4.Array.insert(t.eventQueue,n,[{keyframe:true,ts:e.ts}])}},peekEvent:function(){var e=this,t=e.eventQueue,n=e.queueIndex,r=t[n],i=r&&r.type,s;if(i=="mduclick"){s=[Ext4.applyIf({type:"mousedown"},r),Ext4.applyIf({type:"mouseup"},r),Ext4.applyIf({type:"click"},r)];e.replaceEvent(n,s)}return t[n]||null},replaceEvent:function(e,t){for(var n,r=0,i=t.length;r<i;++r){if(r){n=t[r-1];delete n.afterplay;delete n.screenshot;delete t[r].beforeplay}}Ext4.Array.replace(this.eventQueue,e,1,t)},processEvents:function(){var e=this,t=e.pauseForAnimations&&e.attachTo.Ext4.fx.Manager.items,n;while((n=e.peekEvent())!==null){if(t&&t.getCount()){return true}if(n.keyframe){if(!e.processKeyFrame(n)){return false}e.nextEvent(n)}else if(n.ts<=e.getTimeIndex()&&e.fireEvent("beforeplay",e,n)!==false&&e.playEvent(n)){if(window.__x&&n.screenshot){__x.poll.sendSyncRequest({cmd:"screenshot"})}e.nextEvent(n)}else{return true}}e.stop();return false},processKeyFrame:function(e){var t=this;if(!e.defer){t.makeToken(e,"done");t.fireEvent("keyframe",t,e)}return e.done},injectEvent:function(e,t){t.injectEvent(e)},playEvent:function(e){var t=this,n=t.getElementFromXPath(e.target),r;if(!n){return false}if(!t.playEventHook(e,"beforeplay")){return false}if(!e.injected){e.injected=true;r=t.translateEvent(e,n);t.injectEvent(n,r)}return t.playEventHook(e,"afterplay")},playEventHook:function(e,t){var n=this,r=t+".done",i=t+".fired",s=e[t];if(s&&!e[r]){if(!e[i]){e[i]=true;n.makeToken(e,r);n.eventScope[s](e)}return false}return true},schedule:function(){var e=this;if(!e.timer){e.timer=setTimeout(e.timerFn,10)}},translateEvent:function(e,t){var n=this,r=n.eventObject,i=e.modKeys||"",s;if("x"in e){r.xy=s=Ext4.fly(t).getXY();s[0]+=e.x;s[1]+=e.y}if("wheel"in e){}r.type=e.type;r.button=e.button;r.altKey=i.indexOf("A")>0;r.ctrlKey=i.indexOf("C")>0;r.metaKey=i.indexOf("M")>0;r.shiftKey=i.indexOf("S")>0;return r},onStart:function(){var e=this;e.queueIndex=0;e.schedule()},onStop:function(){var e=this;if(e.timer){clearTimeout(e.timer);e.timer=null}if(window.__x){__x.poll.sendSyncRequest({cmd:"finish"})}},onTick:function(){var e=this;e.timer=null;if(e.processEvents()){e.schedule()}}});Ext4.define("Ext4.ux.event.RecorderManager",{extend:"Ext4.panel.Panel",alias:"widget.eventrecordermanager",uses:["Ext4.ux.event.Recorder","Ext4.ux.event.Player"],layout:"fit",buttonAlign:"left",eventsToIgnore:{mousemove:1,mouseover:1,mouseout:1},bodyBorder:false,playSpeed:1,initComponent:function(){function t(t,n){return{text:t,speed:n,group:"speed",checked:n==e.playSpeed,handler:e.onPlaySpeed,scope:e}}var e=this;e.recorder=new Ext4.ux.event.Recorder({attachTo:e.attachTo,listeners:{add:e.updateEvents,coalesce:e.updateEvents,buffer:200,scope:e}});e.recorder.eventsToRecord=Ext4.apply({},e.recorder.eventsToRecord);e.tbar=[{text:"Record",xtype:"splitbutton",whenIdle:true,handler:e.onRecord,scope:e,menu:e.makeRecordButtonMenu()},{text:"Play",xtype:"splitbutton",whenIdle:true,handler:e.onPlay,scope:e,menu:[t("Recorded Speed (1x)",1),t("Double Speed (2x)",2),t("Quad Speed (4x)",4),"-",t("Full Speed",1e3)]},{text:"Clear",whenIdle:true,handler:e.onClear,scope:e},"->",{text:"Stop",whenActive:true,disabled:true,handler:e.onStop,scope:e}];var n=e.attachTo.testEvents;e.items=[{xtype:"textarea",itemId:"eventView",fieldStyle:"font-family: monospace",selectOnFocus:true,emptyText:"Events go here!",value:n?e.stringifyEvents(n):"",scrollToBottom:function(){var e=this.inputEl.dom;e.scrollTop=e.scrollHeight}}];e.fbar=[{xtype:"tbtext",text:"Attached To: "+e.attachTo.location.href}];e.callParent()},makeRecordButtonMenu:function(){function i(e,t){return e.text<t.text?-1:t.text<e.text?1:0}var e=[],t={},n=this.recorder.eventsToRecord,r=this.eventsToIgnore;Ext4.Object.each(n,function(i,s){var o=t[s.kind];if(!o){t[s.kind]=o=[];e.push({text:s.kind,menu:o})}o.push({text:i,checked:true,handler:function(e){if(e.checked){n[i]=s}else{delete n[i]}}});if(r[i]){o[o.length-1].checked=false;Ext4.Function.defer(function(){delete n[i]},1)}});e.sort(i);Ext4.Array.each(e,function(e){e.menu.sort(i)});return e},getEventView:function(){return this.down("#eventView")},onClear:function(){var e=this.getEventView();e.setValue("")},onPlay:function(){var e=this,t=e.getEventView(),n=t.getValue();if(n){n=Ext4.decode(n);if(n.length){e.player=Ext4.create("Ext4.ux.event.Player",{attachTo:window.opener,eventQueue:n,listeners:{stop:e.onPlayStop,scope:e}});e.player.start();e.syncBtnUI()}}},onPlayStop:function(){this.player=null;this.syncBtnUI()},onPlaySpeed:function(e){this.playSpeed=e.speed},onRecord:function(){this.recorder.start();this.syncBtnUI()},onStop:function(){var e=this;if(e.player){e.player.stop();e.player=null}else{e.recorder.stop()}e.syncBtnUI();e.updateEvents()},syncBtnUI:function(){var e=this,t=!e.player&&!e.recorder.active;Ext4.each(e.query("[whenIdle]"),function(e){e.setDisabled(!t)});Ext4.each(e.query("[whenActive]"),function(e){e.setDisabled(t)});var n=e.getEventView();n.setReadOnly(!t)},stringifyEvents:function(e){var t,n=[];Ext4.each(e,function(e){t=[];Ext4.Object.each(e,function(e,n){if(t.length){t.push(", ")}else{t.push("  { ")}t.push(e,": ");t.push(Ext4.encode(n))});t.push(" }");n.push(t.join(""))});return"[\n"+n.join(",\n")+"\n]"},updateEvents:function(){var e=this,t=e.stringifyEvents(e.recorder.getRecordedEvents()),n=e.getEventView();n.setValue(t);n.scrollToBottom()}});Ext4.define("Ext4.ux.event.Recorder",function(){function e(e,t){return e.x==t.x&&e.y==t.y}return{extend:"Ext4.ux.event.Driver",eventsToRecord:function(){var e={kind:"keyboard",modKeys:true,key:true,bubbles:true},t={kind:"mouse",button:true,modKeys:true,xy:true,bubbles:true};return{keydown:e,keypress:e,keyup:e,mousemove:t,mouseover:t,mouseout:t,click:t,mousedown:t,mouseup:t,scroll:{kind:"misc",bubbles:false}}}(),ignoreIdRegEx:/ext-gen(?:\d+)/,constructor:function(e){var t=this,n=e&&e.eventsToRecord;if(n){t.eventsToRecord=Ext4.apply(Ext4.apply({},t.eventsToRecord),n);delete e.eventsToRecord}t.callParent(arguments);t.addEvents("add","coalesce");t.clear();t.modKeys=[];t.attachTo=t.attachTo||window},clear:function(){this.eventsRecorded=[]},coalesce:function(t){var n=this,r=n.eventsRecorded,i=r.length,s=i&&r[i-1],o;if(!s){return false}if(t.type=="mousemove"){if(s.type=="mousemove"&&t.ts-s.ts<200){t.ts=s.ts;r[i-1]=t;return true}}else if(t.type=="click"){if(i>=2&&s.type=="mouseup"&&(o=r[i-2]).type=="mousedown"){if(t.button==s.button&&t.button==o.button&&t.target==s.target&&t.target==o.target&&e(t,s)&&e(t,o)){r.pop();o.type="mduclick";return true}}}return false},getElementXPath:function(e){var t=this,n=false,r=[],i,s,o,u;for(o=e;o;o=o.parentNode){if(o==t.attachTo.document.body){r.unshift("~");n=true;break}if(o.id&&!t.ignoreIdRegEx.test(o.id)){r.unshift("#"+o.id);n=true;break}for(i=1,s=o;!!(s=s.previousSibling);){if(s.tagName==o.tagName){++i}}u=o.tagName.toLowerCase();if(i<2){r.unshift(u)}else{r.unshift(u+"["+i+"]")}}return n?r.join("/"):null},getRecordedEvents:function(){return this.eventsRecorded},onDomInsert:function(e,t){this.watchTree(t)},onDomRemove:function(e,t){this.unwatchTree(t)},onEvent:function(e){var t=this,n=t.eventsToRecord[e.type],r,i,s,o={type:e.type,ts:t.getTimestamp(),target:t.getElementXPath(e.target)},u;if(!o.target){return}r=e.target.ownerDocument;r=r.defaultView||r.parentWindow;if(r!==t.attachTo){return}if(n.xy){u=e.getXY();if(o.target){s=Ext4.fly(e.getTarget()).getXY();u[0]-=s[0];u[1]-=s[1]}o.x=u[0];o.y=u[1]}if(n.button){o.button=e.button}if(n.wheel){o.wheel=e.getWheelDelta()}if(n.modKeys){t.modKeys[0]=e.altKey?"A":"";t.modKeys[1]=e.ctrlKey?"C":"";t.modKeys[2]=e.metaKey?"M":"";t.modKeys[3]=e.shiftKey?"S":"";i=t.modKeys.join("");if(i){o.modKeys=i}}if(n.key){o.charCode=e.getCharCode();o.keyCode=e.getKey()}if(t.coalesce(o)){t.fireEvent("coalesce",t,o)}else{t.eventsRecorded.push(o);t.fireEvent("add",t,o)}},onStart:function(){var e=this,t={DOMNodeInserted:e.onDomInsert,DOMNodeRemoved:e.onDomRemove,scope:e},n=e.nonBubbleEvents={},r=e.attachTo.Ext4.dd.DragDropManager,i=e.attachTo.Ext4.EventObjectImpl.prototype;e.watchingNodes={};Ext4.Object.each(e.eventsToRecord,function(r,i){if(i){if(i.bubbles){t[r]=e.onEvent}else{n[r]=i}}});e.ddmStopEvent=r.stopEvent;r.stopEvent=Ext4.Function.createSequence(r.stopEvent,function(t){e.onEvent(t)});e.evStopEvent=i.stopEvent;i.stopEvent=Ext4.Function.createSequence(i.stopEvent,function(){e.onEvent(this)});var s=e.attachTo.Ext4.getBody();s.on(t);e.watchTree(s.dom)},onStop:function(){var e=this,t=e.attachTo.Ext4.getBody();Ext4.Object.each(e.eventsToRecord,function(n,r){if(r){t.un(n,e.onEvent,e)}});e.attachTo.Ext4.dd.DragDropManager.stopEvent=e.ddmStopEvent;e.attachTo.Ext4.EventObjectImpl.prototype.stopEvent=e.evStopEvent;e.unwatchTree(t.dom)},watchTree:function(e){if(e.nodeType!=1){return}var t=this,n=e.tagName=="BODY"?"$":e.id,r=t.watchingNodes;if(n&&!r[n]){var i={scope:t};Ext4.Object.each(t.nonBubbleEvents,function(e,n){if(n){i[e]=t.onEvent}});t.attachTo.Ext4.fly(e).on(i);r[n]=true;console.log("watch "+e.tagName+"#"+n)}Ext4.each(e.childNodes,t.watchTree,t)},unwatchTree:function(e){if(e.nodeType!=1){return}var t=this,n=e.tagName=="BODY"?"$":e.id,r=t.watchingNodes;if(n&&!r[n]){Ext4.Object.each(t.nonBubbleEvents,function(n,r){t.attachTo.Ext4.fly(e).un(n,t.onEvent,t)});delete r[n];console.log("unwatch "+e.tagName+"#"+n)}Ext4.each(e.childNodes,t.unwatchTree,t)}}}());Ext4.define("Ext4.ux.layout.Center",{extend:"Ext4.layout.container.Fit",alias:"layout.ux.center",percentRe:/^\d+(?:\.\d+)?\%$/,itemCls:"ux-layout-center-item",initLayout:function(){this.callParent(arguments);this.owner.addCls("ux-layout-center")},getItemSizePolicy:function(e){var t=this.callParent(arguments);if(typeof e.width=="number"){t=this.sizePolicies[t.setsHeight?2:0]}return t},getPos:function(e,t,n){var r=e.props[n]+t.margins[n],i=Math.round((t.targetSize[n]-r)/2);return Math.max(i,0)},getSize:function(e,t,n){var r=e[n];if(typeof r=="string"&&this.percentRe.test(r)){r=parseFloat(r)/100}else{r=e[n+"Ratio"]}return t.targetSize[n]*(r||1)-t.margins[n]},positionItemX:function(e,t){var n=this.getPos(e,t,"width");e.setProp("x",n)},positionItemY:function(e,t){var n=this.getPos(e,t,"height");e.setProp("y",n)},setItemHeight:function(e,t){var n=this.getSize(e.target,t,"height");e.setHeight(n)},setItemWidth:function(e,t){var n=this.getSize(e.target,t,"width");e.setWidth(n)}});Ext4.define("Ext4.ux.data.PagingMemoryProxy",{extend:"Ext4.data.proxy.Memory",alias:"proxy.pagingmemory",alternateClassName:"Ext4.data.PagingMemoryProxy",read:function(e,t,n){var r=this.getReader(),i=r.read(this.data),s,o,u,a;n=n||this;o=e.filters;if(o.length>0){a=[];Ext4.each(i.records,function(e){var t=true,n=o.length,r;for(r=0;r<n;r++){var i=o[r],s=i.filterFn,u=i.scope;t=t&&s.call(u,e)}if(t){a.push(e)}},this);i.records=a;i.totalRecords=i.total=a.length}s=e.sorters;if(s.length>0){u=function(e,t){var n=s[0].sort(e,t),r=s.length,i;for(i=1;i<r;i++){n=n||s[i].sort.call(this,e,t)}return n};i.records.sort(u)}if(e.start!==undefined&&e.limit!==undefined){i.records=i.records.slice(e.start,e.start+e.limit);i.count=i.records.length}Ext4.apply(e,{resultSet:i});e.setCompleted();e.setSuccessful();Ext4.Function.defer(function(){Ext4.callback(t,n,[e])},10)}});Ext4.define("Ext4.ux.PreviewPlugin",{extend:"Ext4.AbstractPlugin",alias:"plugin.preview",requires:["Ext4.grid.feature.RowBody","Ext4.grid.feature.RowWrap"],hideBodyCls:"x-grid-row-body-hidden",bodyField:"",previewExpanded:true,constructor:function(e){this.callParent(arguments);var t=this.bodyField,n=this.hideBodyCls,r=this.getCmp(),i=[{ftype:"rowbody",getAdditionalData:function(e,i,s,o,u){var a=Ext4.grid.feature.RowBody.prototype.getAdditionalData.apply(this,arguments);Ext4.apply(a,{rowBody:e[t],rowBodyCls:r.previewExpanded?"":n});return a}},{ftype:"rowwrap"}];r.previewExpanded=this.previewExpanded;if(!r.features){r.features=[]}r.features=i.concat(r.features)},toggleExpanded:function(e){var t=this.getCmp();this.previewExpanded=t.previewExpanded=e;t.refresh()}});Ext4.define("Ext4.ux.RowExpander",{extend:"Ext4.AbstractPlugin",requires:["Ext4.grid.feature.RowBody","Ext4.grid.feature.RowWrap"],alias:"plugin.rowexpander",rowBodyTpl:null,expandOnEnter:true,expandOnDblClick:true,selectRowOnExpand:false,rowBodyTrSelector:".x-grid-rowbody-tr",rowBodyHiddenCls:"x-grid-row-body-hidden",rowCollapsedCls:"x-grid-row-collapsed",renderer:function(e,t,n,r,i){if(i===0){t.tdCls="x-grid-td-expander"}return'<div class="x-grid-row-expander">&#160;</div>'},constructor:function(){this.callParent(arguments);var e=this.getCmp();this.recordsExpanded={};if(!this.rowBodyTpl){Ext4.Error.raise("The 'rowBodyTpl' config is required and is not defined.")}var t=Ext4.create("Ext4.XTemplate",this.rowBodyTpl),n=[{ftype:"rowbody",columnId:this.getHeaderId(),recordsExpanded:this.recordsExpanded,rowBodyHiddenCls:this.rowBodyHiddenCls,rowCollapsedCls:this.rowCollapsedCls,getAdditionalData:this.getRowBodyFeatureData,getRowBodyContents:function(e){return t.applyTemplate(e)}},{ftype:"rowwrap"}];if(e.features){e.features=n.concat(e.features)}else{e.features=n}},init:function(e){this.callParent(arguments);this.grid=e;this.addExpander();e.on("render",this.bindView,this,{single:true});e.on("reconfigure",this.onReconfigure,this)},onReconfigure:function(){this.addExpander()},addExpander:function(){this.grid.headerCt.insert(0,this.getHeaderConfig())},getHeaderId:function(){if(!this.headerId){this.headerId=Ext4.id()}return this.headerId},getRowBodyFeatureData:function(e,t,n,r){var i=Ext4.grid.feature.RowBody.prototype.getAdditionalData.apply(this,arguments),s=this.columnId;i.rowBodyColspan=i.rowBodyColspan-1;i.rowBody=this.getRowBodyContents(e);i.rowCls=this.recordsExpanded[n.internalId]?"":this.rowCollapsedCls;i.rowBodyCls=this.recordsExpanded[n.internalId]?"":this.rowBodyHiddenCls;i[s+"-tdAttr"]=' valign="top" rowspan="2" ';if(r[s+"-tdAttr"]){i[s+"-tdAttr"]+=r[s+"-tdAttr"]}return i},bindView:function(){var e=this.getCmp().getView(),t;if(!e.rendered){e.on("render",this.bindView,this,{single:true})}else{t=e.getEl();if(this.expandOnEnter){this.keyNav=Ext4.create("Ext4.KeyNav",t,{enter:this.onEnter,scope:this})}if(this.expandOnDblClick){e.on("itemdblclick",this.onDblClick,this)}this.view=e}},onEnter:function(e){var t=this.view,n=t.store,r=t.getSelectionModel(),i=r.getSelection(),s=i.length,o=0,u;for(;o<s;o++){u=n.indexOf(i[o]);this.toggleRow(u)}},toggleRow:function(e){var t=this.view,n=t.getNode(e),r=Ext4.get(n),i=Ext4.get(r).down(this.rowBodyTrSelector),s=t.getRecord(n),o=this.getCmp();if(r.hasCls(this.rowCollapsedCls)){r.removeCls(this.rowCollapsedCls);i.removeCls(this.rowBodyHiddenCls);this.recordsExpanded[s.internalId]=true;t.refreshSize();t.fireEvent("expandbody",n,s,i.dom)}else{r.addCls(this.rowCollapsedCls);i.addCls(this.rowBodyHiddenCls);this.recordsExpanded[s.internalId]=false;t.refreshSize();t.fireEvent("collapsebody",n,s,i.dom)}},onDblClick:function(e,t,n,r,i){this.toggleRow(n)},getHeaderConfig:function(){var e=this,t=Ext4.Function.bind(e.toggleRow,e),n=e.selectRowOnExpand;return{id:this.getHeaderId(),width:24,sortable:false,resizable:false,draggable:false,hideable:false,menuDisabled:true,cls:Ext4.baseCSSPrefix+"grid-header-special",renderer:function(e,t){t.tdCls=Ext4.baseCSSPrefix+"grid-cell-special";return'<div class="'+Ext4.baseCSSPrefix+'grid-row-expander">&#160;</div>'},processEvent:function(e,r,i,s,o,u){if(e=="mousedown"&&u.getTarget(".x-grid-row-expander")){var a=u.getTarget(".x-grid-row");t(a);return n}}}}});Ext4.define("Ext4.ux.IFrame",{extend:"Ext4.Component",alias:"widget.uxiframe",loadMask:"Loading...",src:"about:blank",renderTpl:['<iframe src="{src}" name="{frameName}" width="100%" height="100%" frameborder="0"></iframe>'],initComponent:function(){this.callParent();this.frameName=this.frameName||this.id+"-frame";this.addEvents("beforeload","load");Ext4.apply(this.renderSelectors,{iframeEl:"iframe"})},initEvents:function(){var e=this,t=e.iframeEl.dom,n=e.getFrame();e.callParent();e.iframeEl.on("load",e.onLoad,e)},initRenderData:function(){return Ext4.apply(this.callParent(),{src:this.src,frameName:this.frameName})},getBody:function(){var e=this.getDoc();return e.body||e.documentElement},getDoc:function(){try{return this.getWin().document}catch(e){return null}},getWin:function(){var e=this,t=e.frameName,n=Ext4.isIE?e.iframeEl.dom.contentWindow:window.frames[t];return n},getFrame:function(){var e=this;return e.iframeEl.dom},beforeDestroy:function(){var e=this,t,n;if(e.rendered){try{t=e.getDoc();if(t){Ext4.EventManager.removeAll(t);for(n in t){if(t.hasOwnProperty&&t.hasOwnProperty(n)){delete t[n]}}}}catch(r){}}e.callParent()},onLoad:function(){var e=this,t=e.getDoc(),n=e.onRelayedEvent;if(t){try{Ext4.EventManager.removeAll(t);Ext4.EventManager.on(t,{mousedown:n,mousemove:n,mouseup:n,click:n,dblclick:n,scope:e})}catch(r){}Ext4.EventManager.on(window,"unload",e.beforeDestroy,e);this.el.unmask();this.fireEvent("load",this)}else if(e.src&&e.src!=""){this.el.unmask();this.fireEvent("error",this)}},onRelayedEvent:function(e){var t=this.iframeEl,n=t.getXY(),r=e.getXY();e.xy=[n[0]+r[0],n[1]+r[1]];e.injectEvent(t);e.xy=r},load:function(e){var t=this,n=t.loadMask,r=t.getFrame();if(t.fireEvent("beforeload",t,e)!==false){if(n&&t.el){t.el.mask(n)}r.src=t.src=e||t.src}}});Ext4.define("Ext4.ux.GMapPanel",{extend:"Ext4.panel.Panel",alias:"widget.gmappanel",requires:["Ext4.window.MessageBox"],initComponent:function(){Ext4.applyIf(this,{plain:true,gmapType:"map",border:false});this.callParent()},afterFirstLayout:function(){var e=this.center;this.callParent();if(e){if(e.geoCodeAddr){this.lookupCode(e.geoCodeAddr,e.marker)}else{this.createMap(e)}}else{Ext4.Error.raise("center is required")}},createMap:function(e,t){options=Ext4.apply({},this.mapOptions);options=Ext4.applyIf(options,{zoom:14,center:e,mapTypeId:google.maps.MapTypeId.HYBRID});this.gmap=new google.maps.Map(this.body.dom,options);if(t){this.addMarker(Ext4.applyIf(t,{position:e}))}Ext4.each(this.markers,this.addMarker,this)},addMarker:function(e){e=Ext4.apply({map:this.gmap},e);if(!e.position){e.position=new google.maps.LatLng(e.lat,e.lng)}var t=new google.maps.Marker(e);Ext4.Object.each(e.listeners,function(e,n){google.maps.event.addListener(t,e,n)});return t},lookupCode:function(e,t){this.geocoder=new google.maps.Geocoder;this.geocoder.geocode({address:e},Ext4.Function.bind(this.onLookupComplete,this,[t],true))},onLookupComplete:function(e,t,n){if(t!="OK"){Ext4.MessageBox.alert("Error",'An error occured: "'+t+'"');return}this.createMap(e[0].geometry.location,n)},afterComponentLayout:function(e,t){this.callParent(arguments);this.redraw()},redraw:function(){var e=this.gmap;if(e){google.maps.event.trigger(e,"resize")}}});Ext4.define("Ext4.ux.SlidingPager",{requires:["Ext4.slider.Single","Ext4.slider.Tip"],constructor:function(e){if(e){Ext4.apply(this,e)}},init:function(e){var t=e.items.indexOf(e.child("#inputItem")),n;Ext4.each(e.items.getRange(t-2,t+2),function(e){e.hide()});n=Ext4.create("Ext4.slider.Single",{width:114,minValue:1,maxValue:1,hideLabel:true,tipText:function(e){return Ext4.String.format("Page <b>{0}</b> of <b>{1}</b>",e.value,e.slider.maxValue)},listeners:{changecomplete:function(t,n){e.store.loadPage(n)}}});e.insert(t+1,n);e.on({change:function(e,t){n.setMaxValue(t.pageCount);n.setValue(t.currentPage)}})}});Ext4.define("Ext4.ux.ajax.SimManager",{singleton:true,requires:["Ext4.data.Connection","Ext4.ux.ajax.SimXhr","Ext4.ux.ajax.Simlet","Ext4.ux.ajax.JsonSimlet"],defaultType:"basic",delay:150,ready:false,constructor:function(){this.simlets={}},getSimlet:function(e){var t=this,n=e.indexOf("?");if(n<0){n=e.indexOf("#")}if(n>0){e=e.substring(0,n)}return t.simlets[e]||t.defaultSimlet},getXhr:function(e,t,n,r){var i=this.getSimlet(t);if(i){return i.openRequest(e,t,n,r)}return null},init:function(e){var t=this;Ext4.apply(t,e);if(!t.ready){t.ready=true;if(!("defaultSimlet"in t)){t.defaultSimlet=new Ext4.ux.ajax.Simlet({status:404,statusText:"Not Found"})}t._openRequest=Ext4.data.Connection.prototype.openRequest;Ext4.data.Connection.override({openRequest:function(e,n,r){var i=!e.nosim&&t.getXhr(n.method,n.url,e,r);if(!i){i=this.callParent(arguments)}return i}});if(Ext4.data.JsonP){Ext4.data.JsonP.self.override({createScript:function(e,n,r){var i=Ext4.urlAppend(e,Ext4.Object.toQueryString(n)),s=!r.nosim&&t.getXhr("GET",i,r,true);if(!s){s=this.callParent(arguments)}return s},loadScript:function(e){var t=e.script;if(t.simlet){t.jsonpCallback=e.params[e.callbackKey];t.send(null)}else{this.callParent(arguments)}}})}}return t},openRequest:function(e,t,n){var r={method:e,url:t};return this._openRequest.call(Ext4.data.Connection.prototype,{},r,n)},register:function(e){function n(e){var n=e;if(!n.isSimlet){n=Ext4.create("simlet."+(n.stype||t.defaultType),e)}t.simlets[e.url]=n;n.manager=t}var t=this;t.init();if(Ext4.isArray(e)){Ext4.each(e,n)}else if(e.isSimlet||e.url){n(e)}else{Ext4.Object.each(e,function(e,t){t.url=e;n(t)})}return t}});Ext4.define("Ext4.ux.ajax.XmlSimlet",{extend:"Ext4.ux.ajax.DataSimlet",alias:"simlet.xml",xmlTpl:["<{root}>\n",'<tpl for="data">',"    <{parent.record}>\n",'<tpl for="parent.fields">',"        <{name}>{[parent[values.name]]}</{name}>\n","</tpl>","    </{parent.record}>\n","</tpl>","</{root}>"],doGet:function(e){var t=this,n=t.getData(e),r=t.getPage(e,n),i=e.xhr.options.proxy.reader,s=t.callParent(arguments),o={data:r,reader:i,fields:i.model.getFields(),root:i.root,record:i.record};if(e.groupSpec){o.summaryData=t.getSummary(e,n,r)}var u=Ext4.XTemplate.getTpl(t,"xmlTpl"),a=u.apply(o),f;if(typeof DOMParser!="undefined"){f=(new DOMParser).parseFromString(a,"text/xml")}else{f=new ActiveXObject("Microsoft.XMLDOM");f.async=false;f.loadXML(a)}s.responseText=a;s.responseXML=f;return s}});Ext4.define("Ext4.ux.ajax.Simlet",function(){function i(e){var i;if(Ext4.isDefined(e)){e=decodeURIComponent(e);if(n.test(e)){e=parseInt(e,10)}else if(r.test(e)){e=parseFloat(e)}else if(!!(i=t.test(e))){e=new Date(Date.UTC(+i[1],+i[2]-1,+i[3],+i[4],+i[5],+i[6]))}}return e}var e=/([^?#]*)(#.*)?$/,t=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/,n=/^[+-]?\d+$/,r=/^[+-]?\d+\.\d+$/;return{alias:"simlet.basic",isSimlet:true,responseProps:["responseText","responseXML","status","statusText"],status:200,statusText:"OK",constructor:function(e){Ext4.apply(this,e)},doGet:function(e){var t=this,n={};Ext4.each(t.responseProps,function(e){if(e in t){n[e]=t[e]}});return n},doRedirect:function(e){return false},exec:function(e){var t=this,n={},r="do"+Ext4.String.capitalize(e.method.toLowerCase()),i=t[r];if(i){n=i.call(t,t.getCtx(e.method,e.url,e))}else{n={status:405,statusText:"Method Not Allowed"}}return n},getCtx:function(e,t,n){return{method:e,params:this.parseQueryString(t),url:t,xhr:n}},openRequest:function(e,t,n,r){var i=this.getCtx(e,t),s=this.doRedirect(i),o;if(s){o=s}else{o=new Ext4.ux.ajax.SimXhr({mgr:this.manager,simlet:this,options:n});o.open(e,t,r)}return o},parseQueryString:function(t){var n=e.exec(t),r={},s,o,u,a;if(n&&n[1]){var f,l=n[1].split("&");for(u=0,a=l.length;u<a;++u){if((f=l[u].split("="))[0]){s=decodeURIComponent(f.shift());o=i(f.length>1?f.join("="):f[0]);if(!(s in r)){r[s]=o}else if(Ext4.isArray(r[s])){r[s].push(o)}else{r[s]=[r[s],o]}}}}return r},redirect:function(e,t,n){switch(arguments.length){case 2:if(typeof t=="string"){break}n=t;case 1:t=e;e="GET";break}if(n){t=Ext4.urlAppend(t,Ext4.Object.toQueryString(n))}return this.manager.openRequest(e,t)}}}());Ext4.define("Ext4.ux.ajax.JsonSimlet",{extend:"Ext4.ux.ajax.DataSimlet",alias:"simlet.json",doGet:function(e){var t=this,n=t.getData(e),r=t.getPage(e,n),i=e.xhr.options.proxy.reader,s=t.callParent(arguments),o={};if(i.root){o[i.root]=r;o[i.totalProperty]=n.length}else{o=r}if(e.groupSpec){o.summaryData=t.getSummary(e,n,r)}s.responseText=Ext4.encode(o);return s}});Ext4.define("Ext4.ux.ajax.SimXhr",{readyState:0,mgr:null,simlet:null,constructor:function(e){var t=this;Ext4.apply(t,e);t.requestHeaders={}},abort:function(){var e=this;if(e.timer){clearTimeout(e.timer);e.timer=null}e.aborted=true},getAllResponseHeaders:function(){var e=[];Ext4.Object.each(this.responseHeaders,function(t,n){e.push(t+": "+n)});return e.join("\r\n")},getResponseHeader:function(e){var t=this.responseHeaders;return t&&t[e]||null},open:function(e,t,n,r,i){var s=this;s.method=e;s.url=t;s.async=n!==false;s.user=r;s.password=i;s.setReadyState(1)},overrideMimeType:function(e){this.mimeType=e},schedule:function(){var e=this;e.timer=setTimeout(function(){e.onTick()},e.mgr.delay)},send:function(e){var t=this;t.body=e;if(t.async){t.schedule()}else{t.onComplete()}},setReadyState:function(e){var t=this;if(t.readyState!=e){t.readyState=e;t.onreadystatechange()}},setRequestHeader:function(e,t){this.requestHeaders[e]=t},onreadystatechange:Ext4.emptyFn,onComplete:function(){var me=this,callback;me.readyState=4;Ext4.apply(me,me.simlet.exec(me));callback=me.jsonpCallback;if(callback){var text=callback+"("+me.responseText+")";eval(text)}},onTick:function(){var e=this;e.timer=null;e.onComplete();e.onreadystatechange()}});Ext4.define("Ext4.ux.ajax.DataSimlet",function(){function e(e,t){var n=e.direction,r=n&&n.toUpperCase()=="DESC"?-1:1;return function(n,i){var s=n[e.property],o=i[e.property],u=s<o?-1:o<s?1:0;if(u||!t){return u*r}return t(n,i)}}function t(t,n){for(var r=n,i=t&&t.length;i;){r=e(t[--i],r)}return r}return{extend:"Ext4.ux.ajax.Simlet",getData:function(e){var n=this,r=n.data,i=e.params,s=(i.group||"")+"-"+(i.sort||"")+"-"+(i.dir||""),o,u;if(!s){return r}e.groupSpec=i.group&&Ext4.decode(i.group);if(s==n.currentOrder){return n.sortedData}o=i.sort;if(i.dir){o=[{direction:i.dir,property:o}]}else{o=Ext4.decode(i.sort)}u=t(e.sortSpec=o);u=t(e.groupSpec,u);r=r.slice(0);if(u){Ext4.Array.sort(r,u)}n.sortedData=r;n.currentOrder=s;return r},getPage:function(e,t){var n=t,r=t.length,i=e.params.start||0,s=e.params.limit?Math.min(r,i+e.params.limit):r;if(i||s<r){n=n.slice(i,s)}return n},getGroupSummary:function(e,t,n){return t[0]},getSummary:function(e,t,n){function l(){if(s){u.push(r.getGroupSummary(i,s,e));s=null}}var r=this,i=e.groupSpec[0].property,s,o={},u=[],a,f;Ext4.each(n,function(e){a=e[i];o[a]=true});Ext4.each(t,function(e){a=e[i];if(f!==a){l();f=a}if(!o[a]){return!u.length}if(s){s.push(e)}else{s=[e]}return true});l();return u}}}());Ext4.define("Ext4.ux.FieldReplicator",{singleton:true,init:function(e){if(!e.replicatorId){e.replicatorId=Ext4.id()}e.on("blur",this.onBlur,this)},onBlur:function(e){var t=e.ownerCt,n=e.replicatorId,r=Ext4.isEmpty(e.getRawValue()),i=t.query("[replicatorId="+n+"]"),s=i[i.length-1]===e,o,u;if(r&&!s){Ext4.Function.defer(e.destroy,10,e)}else if(!r&&s){if(e.onReplicate){e.onReplicate()}o=e.cloneConfig({replicatorId:n});u=t.items.indexOf(e);t.add(u+1,o)}}});Ext4.define("Ext4.ux.CheckColumn",{extend:"Ext4.grid.column.Column",alias:"widget.checkcolumn",stopSelection:true,tdCls:Ext4.baseCSSPrefix+"grid-cell-checkcolumn",constructor:function(){this.addEvents("beforecheckchange","checkchange");this.callParent(arguments)},processEvent:function(e,t,n,r,i,s,o,u){var a=this,f=e==="keydown"&&s.getKey(),l=e=="mousedown";if(l||f==s.ENTER||f==s.SPACE){var c=a.dataIndex,h=!o.get(c);if(a.fireEvent("beforecheckchange",a,r,h)!==false){o.set(c,h);a.fireEvent("checkchange",a,r,h);if(l){s.stopEvent()}if(!a.stopSelection){t.selModel.selectByPosition({row:r,column:i})}return false}else{return!a.stopSelection}}else{return a.callParent(arguments)}},renderer:function(e){var t=Ext4.baseCSSPrefix,n=[t+"grid-checkheader"];if(e){n.push(t+"grid-checkheader-checked")}return'<div class="'+n.join(" ")+'">&#160;</div>'}});Ext4.define("Ext4.ux.TabCloseMenu",{alias:"plugin.tabclosemenu",mixins:{observable:"Ext4.util.Observable"},closeTabText:"Close Tab",showCloseOthers:true,closeOthersTabsText:"Close Other Tabs",showCloseAll:true,closeAllTabsText:"Close All Tabs",extraItemsHead:null,extraItemsTail:null,constructor:function(e){this.addEvents("aftermenu","beforemenu");this.mixins.observable.constructor.call(this,e)},init:function(e){this.tabPanel=e;this.tabBar=e.down("tabbar");this.mon(this.tabPanel,{scope:this,afterlayout:this.onAfterLayout,single:true})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:"div.x-tab"})},onBeforeDestroy:function(){Ext4.destroy(this.menu);this.callParent(arguments)},onContextMenu:function(e,t){var n=this,r=n.createMenu(),i=true,s=true,o=n.tabBar.getChildByElement(t),u=n.tabBar.items.indexOf(o);n.item=n.tabPanel.getComponent(u);r.child('*[text="'+n.closeTabText+'"]').setDisabled(!n.item.closable);if(n.showCloseAll||n.showCloseOthers){n.tabPanel.items.each(function(e){if(e.closable){i=false;if(e!=n.item){s=false;return false}}return true});if(n.showCloseAll){r.child('*[text="'+n.closeAllTabsText+'"]').setDisabled(i)}if(n.showCloseOthers){r.child('*[text="'+n.closeOthersTabsText+'"]').setDisabled(s)}}e.preventDefault();n.fireEvent("beforemenu",r,n.item,n);r.showAt(e.getXY())},createMenu:function(){var e=this;if(!e.menu){var t=[{text:e.closeTabText,scope:e,handler:e.onClose}];if(e.showCloseAll||e.showCloseOthers){t.push("-")}if(e.showCloseOthers){t.push({text:e.closeOthersTabsText,scope:e,handler:e.onCloseOthers})}if(e.showCloseAll){t.push({text:e.closeAllTabsText,scope:e,handler:e.onCloseAll})}if(e.extraItemsHead){t=e.extraItemsHead.concat(t)}if(e.extraItemsTail){t=t.concat(e.extraItemsTail)}e.menu=Ext4.create("Ext4.menu.Menu",{items:t,listeners:{hide:e.onHideMenu,scope:e}})}return e.menu},onHideMenu:function(){var e=this;e.item=null;e.fireEvent("aftermenu",e.menu,e)},onClose:function(){this.tabPanel.remove(this.item)},onCloseOthers:function(){this.doClose(true)},onCloseAll:function(){this.doClose(false)},doClose:function(e){var t=[];this.tabPanel.items.each(function(n){if(n.closable){if(!e||n!=this.item){t.push(n)}}},this);Ext4.each(t,function(e){this.tabPanel.remove(e)},this)}});Ext4.define("Ext4.ux.ProgressBarPager",{requires:["Ext4.ProgressBar"],width:225,defaultText:"Loading...",defaultAnimCfg:{duration:1e3,easing:"bounceOut"},constructor:function(e){if(e){Ext4.apply(this,e)}},init:function(e){var t;if(e.displayInfo){this.parent=e;t=e.child("#displayItem");if(t){e.remove(t,true)}this.progressBar=Ext4.create("Ext4.ProgressBar",{text:this.defaultText,width:this.width,animate:this.defaultAnimCfg,style:{cursor:"pointer"},listeners:{el:{scope:this,click:this.handleProgressBarClick}}});e.displayItem=this.progressBar;e.add(e.displayItem);Ext4.apply(e,this.parentOverrides)}},handleProgressBarClick:function(e){var t=this.parent,n=t.displayItem,r=this.progressBar.getBox(),i=e.getXY(),s=i[0]-r.x,o=Math.ceil(t.store.getTotalCount()/t.pageSize),u=Math.max(Math.ceil(s/(n.width/o)),1);t.store.loadPage(u)},parentOverrides:{updateInfo:function(){if(this.displayItem){var e=this.store.getCount(),t=this.getPageData(),n=e===0?this.emptyMsg:Ext4.String.format(this.displayMsg,t.fromRecord,t.toRecord,this.store.getTotalCount()),r=t.pageCount>0?t.currentPage/t.pageCount:0;this.displayItem.updateProgress(r,n,this.animate||this.defaultAnimConfig)}}}});Ext4.define("Ext4.ux.statusbar.ValidationStatus",{extend:"Ext4.Component",requires:["Ext4.util.MixedCollection"],errorIconCls:"x-status-error",errorListCls:"x-status-error-list",validIconCls:"x-status-valid",showText:"The form has errors (click for details...)",hideText:"Click again to hide the error list",submitText:"Saving...",init:function(e){e.on("render",function(){this.statusBar=e;this.monitor=true;this.errors=Ext4.create("Ext4.util.MixedCollection");this.listAlign=e.statusAlign==="right"?"br-tr?":"bl-tl?";if(this.form){this.formPanel=Ext4.getCmp(this.form);this.basicForm=this.formPanel.getForm();this.startMonitoring();this.basicForm.on("beforeaction",function(e,t){if(t.type==="submit"){this.monitor=false}},this);var t=function(){this.monitor=true};this.basicForm.on("actioncomplete",t,this);this.basicForm.on("actionfailed",t,this)}},this,{single:true});e.on({scope:this,afterlayout:{single:true,fn:function(){e.statusEl.getEl().on("click",this.onStatusClick,this,{buffer:200})}},beforedestroy:{single:true,fn:this.onDestroy}})},startMonitoring:function(){this.basicForm.getFields().each(function(e){e.on("validitychange",this.onFieldValidation,this)},this)},stopMonitoring:function(){this.basicForm.getFields().each(function(e){e.un("validitychange",this.onFieldValidation,this)},this)},onDestroy:function(){this.stopMonitoring();this.statusBar.statusEl.un("click",this.onStatusClick,this);this.callParent(arguments)},onFieldValidation:function(e,t){if(!this.monitor){return false}var n=e.getErrors()[0];if(n){this.errors.add(e.id,{field:e,msg:n})}else{this.errors.removeAtKey(e.id)}this.updateErrorList();if(this.errors.getCount()>0){if(this.statusBar.getText()!==this.showText){this.statusBar.setStatus({text:this.showText,iconCls:this.errorIconCls})}}else{this.statusBar.clearStatus().setIcon(this.validIconCls)}},updateErrorList:function(){if(this.errors.getCount()>0){var e="<ul>";this.errors.each(function(t){e+='<li id="x-err-'+t.field.id+'"><a href="#">'+t.msg+"</a></li>"},this);this.getMsgEl().update(e+"</ul>")}else{this.getMsgEl().update("")}this.getMsgEl().setSize("auto","auto")},getMsgEl:function(){if(!this.msgEl){this.msgEl=Ext4.DomHelper.append(Ext4.getBody(),{cls:this.errorListCls},true);this.msgEl.hide();this.msgEl.on("click",function(e){var t=e.getTarget("li",10,true);if(t){Ext4.getCmp(t.id.split("x-err-")[1]).focus();this.hideErrors()}},this,{stopEvent:true})}return this.msgEl},showErrors:function(){this.updateErrorList();this.getMsgEl().alignTo(this.statusBar.getEl(),this.listAlign).slideIn("b",{duration:300,easing:"easeOut"});this.statusBar.setText(this.hideText);this.formPanel.el.on("click",this.hideErrors,this,{single:true})},hideErrors:function(){var e=this.getMsgEl();if(e.isVisible()){e.slideOut("b",{duration:300,easing:"easeIn"});this.statusBar.setText(this.showText)}this.formPanel.el.un("click",this.hideErrors,this)},onStatusClick:function(){if(this.getMsgEl().isVisible()){this.hideErrors()}else if(this.errors.getCount()>0){this.showErrors()}}});Ext4.define("Ext4.ux.statusbar.StatusBar",{extend:"Ext4.toolbar.Toolbar",alternateClassName:"Ext4.ux.StatusBar",alias:"widget.statusbar",requires:["Ext4.toolbar.TextItem"],cls:"x-statusbar",busyIconCls:"x-status-busy",busyText:"Loading...",autoClear:5e3,emptyText:"&#160;",activeThreadId:0,initComponent:function(){var e=this.statusAlign==="right";this.callParent(arguments);this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=Ext4.create("Ext4.toolbar.TextItem",{cls:"x-status-text "+(this.currIconCls||""),text:this.text||this.defaultText||""});if(e){this.cls+=" x-status-right";this.add("->");this.add(this.statusEl)}else{this.insert(0,this.statusEl);this.insert(1,"->")}},setStatus:function(e){var t=this;e=e||{};Ext4.suspendLayouts();if(Ext4.isString(e)){e={text:e}}if(e.text!==undefined){t.setText(e.text)}if(e.iconCls!==undefined){t.setIcon(e.iconCls)}if(e.clear){var n=e.clear,r=t.autoClear,i={useDefaults:true,anim:true};if(Ext4.isObject(n)){n=Ext4.applyIf(n,i);if(n.wait){r=n.wait}}else if(Ext4.isNumber(n)){r=n;n=i}else if(Ext4.isBoolean(n)){n=i}n.threadId=this.activeThreadId;Ext4.defer(t.clearStatus,r,t,[n])}Ext4.resumeLayouts(true);return t},clearStatus:function(e){e=e||{};var t=this,n=t.statusEl;if(e.threadId&&e.threadId!==t.activeThreadId){return t}var r=e.useDefaults?t.defaultText:t.emptyText,i=e.useDefaults?t.defaultIconCls?t.defaultIconCls:"":"";if(e.anim){n.el.puff({remove:false,useDisplay:true,callback:function(){n.el.show();t.setStatus({text:r,iconCls:i})}})}else{t.setStatus({text:r,iconCls:i})}return t},setText:function(e){var t=this;t.activeThreadId++;t.text=e||"";if(t.rendered){t.statusEl.setText(t.text)}return t},getText:function(){return this.text},setIcon:function(e){var t=this;t.activeThreadId++;e=e||"";if(t.rendered){if(t.currIconCls){t.statusEl.removeCls(t.currIconCls);t.currIconCls=null}if(e.length>0){t.statusEl.addCls(e);t.currIconCls=e}}else{t.currIconCls=e}return t},showBusy:function(e){if(Ext4.isString(e)){e={text:e}}e=Ext4.applyIf(e||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(e)}})